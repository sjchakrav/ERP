YUI.add("mobile-photo-well-view",function(e){var t=3,n="https://m.flickr.com/photos/{nsid}/{photoid}/play/",r=500,i=500;e.namespace("Views")[this.name]=e.Base.create("mobile-photo-well-view",e.FlickrView,[],{langBundles:["common"],initializer:function(t){this.photoId=t.photoId,this.context=e.clone(t.context,!0);var n=this.appContext.getUA().os;this.nsid=t.nsid,this.disablePinchZooming=n==="windows",this.isAndroid=n==="android";if(this.context&&this.context.params&&this.context.params.isSharedEntity){var r=this.context.params;this.appContext.setGPCredentials({gp_code:r.gpCode,gp_owner:r.gpOwner,share_code:r.gpCode})}else this.appContext.setGPCredentials(null);return this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.set("photoModel",e)})),e.Promise.all(n)},buildContainer:function(){var s,o,u=this.get("photoModel").getValue("isVideo"),a;if(!YUI.Env.isServer){s=parseInt(e.StorageHelper.getItem("mobile-photo-well-width"),10),o=parseInt(e.StorageHelper.getItem("mobile-photo-well-height"),10);if(!s||isNaN(s)||s<50)s=r;if(!o||isNaN(o)||o<50)o=i}var f=this.get("photoModel").getSizeToFit({width:s*t,height:o*t},{cropToFit:!0});return this.set("bestImageSize",f),a=Math.max(f.height/t,o),this.setContainerHTML(this.templates("mobile-photo-well")({maxHeight:a,url:f.url,videoURL:n.replace("{nsid}",this.nsid).replace("{photoid}",this.photoId),isVideo:u})),this},activate:function(){var e=this.get("container"),t=e.one(".main-image"),n=e.one(".main-image-wrapper"),r=this.get("photoModel"),i=this.get("photoModel").getValue("isVideo"),s=this;this.findBestPhoto(r,t),this.appContext.getViewCounter().queue(this.get("photoModel").getValue("id"),this.appContext.getReferrer()),this.loadAdjacentPhotos();var o=parseInt(n.getComputedStyle("height"),10);return this.get("container").setStyle("height",o+"px"),n.setStyle("position","absolute"),!i&&!this.disablePinchZooming&&this.addPinchy(),window.orientation&&(window.onorientationchange=function(){var e=window.innerWidth,t=window.innerHeight,n=e>t,r=[[0,0],[n?t:e,n?e:t]];s.transform.updateBoundingBox(r),s.transform.updateImageSize()}),this.context&&this.context.modelName&&this.context.params&&this.appContext.getModel(this.context.modelName,this.context.params).then(function(e){if(e)return s.set("contextModel",e),e.getValue("photoContextList").getContext({photoId:s.photoId}).then(function(){var t=-1,n=e.getValue("photoContextList").getList();n.some(function(e,n){return e.id===s.photoId&&(t=n),t>0});if(t>-1){var r,i,o,u,a="/in/"+e.getValue("urlSuffix");t>0&&(r=n[t-1],r&&(o=r.getValue("url")+a)),t<n.length-1&&(i=n[t+1],i&&(u=i.getValue("url")+a)),o&&s.get("container").one(".prev-photo").setAttribute("href",o).removeClass("hide-nav-link"),u&&s.get("container").one(".next-photo").setAttribute("href",u).removeClass("hide-nav-link")}})}),this},addPinchy:function(){var n=window.innerWidth,r=window.innerHeight,i=n>r,s=this.get("container").one(".main-image-wrapper"),o=this.get("container").one(".main-image-wrapper-underlay"),u=[[0,0],[i?r:n,i?n:r]],a=this,f;this.transform=e.MrPinchy.init({node:s,maxScale:i?2:t,minScale:1,boundingBox:u}),f=this.transform.getTouchHandler(),this.largeLoaded=!1,s.on("touchstart",function(t){f(t),a.largeLoaded||(a.largeLoaded=!0,a.findBestPhoto(a.get("photoModel"),s.one(".img"),!0,!0)),a.addZoomTimeout=setTimeout(function(){a.get("container").addClass("zoomed"),s.addClass("zoomed"),e.one("html").setStyle("position","fixed"),o.setStyle("display","block"),setTimeout(function(){o.addClass("show-overlay")},10)},200)}),s.on("touchmove",function(e){f(e)}),s.on("touchend",function(e){f(e)}),s.on("touchcancel",function(e){a.transform.resetTransform(),a.transform.fire("mrpinchy:reset")}),this.transform.on("mrpinchy:reset",function(){clearTimeout(a.addZoomTimeout),a.get("container").removeClass("zoomed"),s.removeClass("zoomed"),e.one("html").setStyle("position",null),o.removeClass("show-overlay"),setTimeout(function(){o.setStyle("display","none")},800)}),this.transform.on("mrpinchy:endpinch",function(t){t===1&&(clearTimeout(a.addZoomTimeout),a.get("container").removeClass("zoomed"),s.removeClass("zoomed"),e.one("html").setStyle("position",null),o.removeClass("show-overlay"),setTimeout(function(){o.setStyle("display","none")},800))})},getUsableAreaSize:function(){var e=window.innerWidth,t=window.innerHeight,n=t-50-50;return this.get("container").ancestor(".show-upsell-banner")&&(n-=50),{actualW:e,actualH:t,adjustedH:n}},findBestPhoto:function(n,r,i,s){var o=this.getUsableAreaSize(),u=o.actualW,a=o.actualH,f=n.getSizeToFit({width:i?u*t:u,height:i?a*t:a},{cropToFit:!0});a=Math.min(u/f.width*f.height,o.adjustedH);if(r)r.getAttribute("src")!==f.url&&r.setAttribute("src",f.url),this.set("bestImageSize",f),r.setStyle("height",a),this.get("container").setStyle("height",a),YUI.Env.isServer||(e.StorageHelper.setItem("mobile-photo-well-width",u),e.StorageHelper.setItem("mobile-photo-well-height",o.adjustedH));else{var l=new Image;l.src=f.url}},loadAdjacentPhotos:function(){var e=this.get("prevPhoto"),t=this.get("nextPhoto");t&&this.findBestPhoto(t),e&&this.findBestPhoto(e)}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-photo-well","viewport-data","storage-helper","mrpinchy"],langBundles:["common"]});
YUI.add("hermes-template-mobile-photo-engagement",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s,o;r+='\n			<span class="fave-count-label" style="margin-left: ',(i=n.faveSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.faveSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				',s=n["if"].call(e,(i=e.engagement,i==null||i===!1?i:i.isFaved),{hash:{},inverse:l.program(4,d,t),fn:l.program(2,p,t),data:t});if(s||s===0)r+=s;return r+="\n				",o={hash:{},data:t},r+=f((i=n.friendlyNumber||e.friendlyNumber,i?i.call(e,(i=e.engagement,i==null||i===!1?i:i.faveCount),o):c.call(e,"friendlyNumber",(i=e.engagement,i==null||i===!1?i:i.faveCount),o)))+"\n			</span>\n		",r}function p(e,t){return'\n					<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n				'}function d(e,t){return'\n					<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n				'}function v(e,t){var r="",i;return r+='\n			<span class="fave-count-label" style="margin-left: ',(i=n.faveSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.faveSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n				0\n			</span>\n		',r}function m(e,t){var r="",i,s;return r+='\n			<span class="comment-count-label" style="margin-left: ',(i=n.commentSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.commentSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n				',s={hash:{},data:t},r+=f((i=n.friendlyNumber||e.friendlyNumber,i?i.call(e,(i=e.engagement,i==null||i===!1?i:i.commentCount),s):c.call(e,"friendlyNumber",(i=e.engagement,i==null||i===!1?i:i.commentCount),s)))+"\n			</span>\n		",r}function g(e,t){var r="",i;return r+='\n			<span class="comment-count-label" style="margin-left: ',(i=n.commentSvgMargin)?i=i.call(e,{hash:{},data:t}):(i=e.commentSvgMargin,i=typeof i===a?i.apply(e):i),r+=f(i)+'px">\n				<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n			0</span>\n		',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<div class="actions-container">\n	<div class="fave-count">\n		',u=n["if"].call(t,(o=t.engagement,o==null||o===!1?o:o.faveCount),{hash:{},inverse:l.program(6,v,i),fn:l.program(1,h,i),data:i});if(u||u===0)s+=u;s+='\n	</div>\n\n	<div class="comment-count">\n		',u=n["if"].call(t,(o=t.engagement,o==null||o===!1?o:o.commentCount),{hash:{},inverse:l.program(10,g,i),fn:l.program(8,m,i),data:i});if(u||u===0)s+=u;return s+='\n	</div>\n\n	<div class="share-container">\n		<span class="share-container-icon">\n			<svg class="icon icon-share_hollow"><use xlink:href="#icon-share_hollow"></use></svg>\n		</span>\n	</div>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-engagement",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-mobile-share-modal",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="share">\n	<p>',a={hash:{intlName:"share-modal.SHARE"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'</p>\n\n	<form>\n		<input type="text" value="',(u=n.shortUrl)?u=u.call(t,{hash:{},data:i}):(u=t.shortUrl,u=typeof u===c?u.apply(t):u),s+=l(u)+'" readonly>\n	</form>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-share-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-stats-photo",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+='\n\n	<div class="photo-stats-basics">\n		<div class="photo-stats-basics-left">\n			<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===f?i.apply(e):i),r+=a(i)+'" class="photo-thumbnail" style="background-image: url(',(i=n.photoUrl)?i=i.call(e,{hash:{},data:t}):(i=e.photoUrl,i=typeof i===f?i.apply(e):i),r+=a(i)+');"></a>\n			<div class="photo-info">\n				<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===f?i.apply(e):i),r+=a(i)+'" class="photo-title truncate">',(i=n.title)?i=i.call(e,{hash:{},data:t}):(i=e.title,i=typeof i===f?i.apply(e):i),r+=a(i)+'</a>\n				<div class="photo-posted-date">\n					',o={hash:{},inverse:l.noop,fn:l.program(2,h,t),data:t},s=(i=n.friendlyDateScrappySubphoto||e.friendlyDateScrappySubphoto,i?i.call(e,e.datePosted,!1,!1,o):u.call(e,"friendlyDateScrappySubphoto",e.datePosted,!1,!1,o));if(s||s===0)r+=s;r+='\n				</div>\n			</div>\n		</div>\n		<div class="photo-stats-basics-right">\n			<div class="view-count"><i></i> '+a((i=(i=e.basicStats,i==null||i===!1?i:i.viewCount),typeof i===f?i.apply(e):i))+'</div>\n			<div class="fave-count"><i></i> '+a((i=(i=e.basicStats,i==null||i===!1?i:i.faveCount),typeof i===f?i.apply(e):i))+'</div>\n			<div class="comment-count"><i></i> '+a((i=(i=e.basicStats,i==null||i===!1?i:i.commentCount),typeof i===f?i.apply(e):i))+'</div>\n		</div>\n	</div>\n\n	<div class="photo-stats-nav">\n		<div class="nav-links">\n			<div class="photo-stats-nav-link selected" data-link="views">',o={hash:{intlName:"stats.RECENT_VIEWS"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'</div>\n			<div class="photo-stats-nav-link" data-link="sources">',o={hash:{intlName:"stats.SOURCES"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'</div>\n		</div>\n		<div class="photo-stats-nav-extras">\n			<div class="date-picker">',(s=n.prettyDateString)?s=s.call(e,{hash:{},data:t}):(s=e.prettyDateString,s=typeof s===f?s.apply(e):s),r+=a(s)+' <span></span></div>\n		</div>\n	</div>\n\n	<div class="photo-stats-sections" data-showing="views">\n\n		<div class="photo-stats-section" data-section="views">\n			<div class="daily-views-graph">\n			</div>\n		</div>\n\n		<div class="photo-stats-section" data-section="sources">\n\n			<div class="source-breakdown-left',s=n.unless.call(e,e.hasReferrers,{hash:{},inverse:l.noop,fn:l.program(4,p,t),data:t});if(s||s===0)r+=s;r+='">\n				<div class="no-sources">\n					',o={hash:{intlName:"stats.NO_SOURCES_TODAY"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'\n				</div>\n\n				<div class="sources-pie-chart pie-chart"></div>\n			</div>\n\n			<div class="source-breakdown-right',s=n.unless.call(e,e.hasReferrers,{hash:{},inverse:l.noop,fn:l.program(4,p,t),data:t});if(s||s===0)r+=s;return r+='">\n				<div class="sources-breakdown">\n					<div class="sources-breakdown-header">\n						<div>',o={hash:{intlName:"stats.SOURCES"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</div>\n						<div>",o={hash:{intlName:"stats.VISITS"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'</div>\n						<div>%</div>\n					</div>\n					<div class="sources-breakdown-list"></div>\n				</div>\n			</div>\n\n		</div>\n\n	</div>\n\n',r}function h(e,t){var r="",i,s;return r+="\n						",s={hash:{intlName:e.intlName,intlDate:e.intlDate},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n					",r}function p(e,t){return" no-results"}function d(e,t){var r="",i,s;return r+='\n\n	<div class="no-stats-available">\n		',s={hash:{intlName:"stats.NO_RECENT_PHOTO_STATS_AVAILABLE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n	</div>\n\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;o=n["if"].call(t,t.actuallyHasSomeStats,{hash:{},inverse:l.program(6,d,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/stats-photo",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("timezone-helper",function(e){"use strict";e.TimezoneHelper=function(t,n,r){r?(this.tz=r,this.dst=!1):(this.tz=t.getViewer().prefs.timezonePref.offset,this.dst=t.getViewer().prefs.timezonePref.dst),this.momentObject=e.moment(n,"X"),this.momentObject.utcOffset(this.tz),this.dst&&this.momentObject.isDST()&&this.momentObject.add(1,"hour")},e.TimezoneHelper.prototype.toFormat=function(e){return this.momentObject.format(e)}},"@VERSION@",{requires:["moment"]});
YUI.add("stats-helper",function(e){"use strict";var t;YUI.Env.isServer?t=require("querystring").stringify:t=function(e){var t=[],n,r,i;for(n in e)if(e.hasOwnProperty(n))if(Array.isArray(e[n]))for(r=0,i=e[n].length;r<i;r++)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n][r]));else t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},e.StatsHelper=function(){},e.StatsHelper.prototype.moveToFrontOfArray=function(e,t){var n=-1;return e.forEach(function(e,r){e===t&&(n=r)}),n>-1&&e.unshift(e.splice(n,1)[0]),e},e.StatsHelper.prototype.moveToEndOfArray=function(e,t){var n=-1;return e.forEach(function(e,r){e===t&&(n=r)}),n>-1&&(e.push(e[n]),e.splice(n,1)),e},e.StatsHelper.prototype.whichChild=function(e){var t=0;while((e=e.previousElementSibling)!==null)++t;return t},e.StatsHelper.prototype.getRoundedRectanglePath=function(e,t,n,r,i,s,o){var u=e[0],a=e[1],f=t[0],l=t[1],c;return c="M"+(u+n)+","+a,c+="h"+(f-2*n),i?c+="a"+n+","+n+" 0 0 1 "+n+","+n:(c+="h"+n,c+="v"+n),c+="v"+(l-2*n),o?c+="a"+n+","+n+" 0 0 1 "+ -n+","+n:(c+="v"+n,c+="h"+ -n),c+="h"+(2*n-f),s?c+="a"+n+","+n+" 0 0 1 "+ -n+","+ -n:(c+="h"+ -n,c+="v"+ -n),c+="v"+(2*n-l),r?c+="a"+n+","+n+" 0 0 1 "+n+","+ -n:(c+="v"+ -n,c+="h"+n),c+="z",c},e.StatsHelper.prototype.getIdFromParams=function(e){var n=t(e);return n===""&&(n=1),n},e.StatsHelper.prototype.convertStorageTotalToRealNumber=function(e){var t=e;return e===-1&&(t=-1),t},e.StatsHelper.prototype.convertStorageAmountToRealNumber=function(e){var t,n,r,i=100;return e=parseInt(e,10)||1,t=Math.ceil(Math.log(e)/Math.LN10),n=Math.floor(t/3),r=e/Math.pow(10,n*3),r=Math.floor(r*i)/i,r}},"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom"],optional:[]});
YUI.add("flickr-stats-photo-daily-views-fetcher",function(e){"use strict";function t(e){var t={id:e.id,photo_id:e.photoId};return t}function n(t,n){var r=t.apiResponse.stats,i=r.graphdata,s=t.modelRegistry,o,u={},a={},f=[],l,c,h,p,d;return d={views:0,favs:0,comments:0},o={id:n.id},i&&(u=i,f=Object.keys(i),f.forEach(function(e,t){!u[e].burp&&!u[e].nodot?(c?(c>e&&(c=e),p<e&&(p=e)):(c=e,p=e),u[e].views||(u[e].views=0),u[e].comments||(u[e].comments=0),u[e].favs||(u[e].favs=0),u[e].views=parseInt(u[e].views,10),u[e].favs=parseInt(u[e].favs,10),u[e].comments=parseInt(u[e].comments,10),d.views+=u[e].views,d.favs+=u[e].favs,d.comments+=u[e].comments):delete u[e]})),o.days=u,o.oldestDate=c,o.newestDate=p,o.totals=d,s.exists(o.id)?(a=s.getValue("days"),o.days=e.merge(o.days,a),l=s.getValue("oldestDate"),c>l&&(o.oldestDate=l),h=s.getValue("newestDate"),p>h&&(o.newestDate=h),o.totals+=e.merge(o.totals,s.getValue("totals")),s.setValues(o.id,o)):s.add(o),o}function r(t,n){var r=this;return(new e.FlickrPromise({apiResponse:n.callAPI("flickr.stats.photo.getGraphData",this._processParams(t)),modelRegistry:n.getModelRegistry("stats-photo-daily-views-models")})).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-stats-photo-daily-views-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-stats-photo-daily-views"]={run:r,_processResponse:n,_processParams:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["stats-photo-daily-views-models"]});
YUI.add("stats-photo-daily-views-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-stats-photo-daily-views"].run(t,this.appContext)}},attributes:{days:{},oldestDate:{},newestDate:{},totals:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-stats-photo-daily-views-fetcher"]});
YUI.add("flickr-stats-referrer-domains-fetcher",function(e){"use strict";function n(e){var t={id:e.id,date:e.date||"",photo_id:e.photoId||""};return t}function r(e,n){var r=e.apiResponse,i=e.modelRegistry,s,o={},u={},a=0,f;return s={id:n.id},delete r.stat,f=Object.keys(r),f.forEach(function(e,n){var i=t[e.toLowerCase()];i||(i="other"),o[i]||(o[i]={}),u[i]||(u[i]=0),u[i]+=r[e].viewcount,a+=r[e].viewcount,delete r[e].viewcount,o[i]=r[e]}),s.referrers=o,s.totals=u,s.total=a,i.exists(s.id)?i.setValues(s.id,s):i.add(s),s}function i(t,n){var r=this;return(new e.FlickrPromise({apiResponse:n.callAPI("flickr.stats.getReferrerCategoriesForDate",this._processParams(t)),modelRegistry:n.getModelRegistry("stats-referrer-domains-models")})).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-stats-referrer-domains-fetcher] failed getting or processing API response:",e),e})}var t={flickr:"flickr","search engine":"search",social:"social",yahoo:"search",google:"search",bing:"search",twitter:"social",facebook:"social",pinterest:"social",tumblr:"social"};e.namespace("ModelFetchers")["flickr-stats-referrer-domains"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["stats-referrer-domains-models"]});
YUI.add("stats-referrer-domains-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-stats-referrer-domains"].run(t,this.appContext)}},attributes:{referrers:{},totals:{},total:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-stats-referrer-domains-fetcher"]});
YUI.add("stats-photo-view",function(e){var t=500;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.statsHelper=new e.StatsHelper,this.photoId=t.photoId,this.dateString=t.dateString,this.prettyDateString=t.prettyDateString||t.dateString,this.realtimeDateString=t.realtimeDateString||t.dateString,this.isOwner=t.isOwner,this.nsid=t.nsid,this.isPro=!1,this.pickers={},this.tooltip,this.dateIntl={previousMonth:this.intlMessage({intlName:"pikaday.PREVIOUS_MONTH"}),nextMonth:this.intlMessage({intlName:"pikaday.NEXT_MONTH"})},this.dateIntl.weekdays=[this.intlMessage({intlName:"pikaday.SUNDAY"}),this.intlMessage({intlName:"pikaday.MONDAY"}),this.intlMessage({intlName:"pikaday.TUESDAY"}),this.intlMessage({intlName:"pikaday.WEDNESDAY"}),this.intlMessage({intlName:"pikaday.THURSDAY"}),this.intlMessage({intlName:"pikaday.FRIDAY"}),this.intlMessage({intlName:"pikaday.SATURDAY"})],this.dateIntl.weekdaysShort=[this.intlMessage({intlName:"pikaday.SUNDAY_SHORT"}),this.intlMessage({intlName:"pikaday.MONDAY_SHORT"}),this.intlMessage({intlName:"pikaday.TUESDAY_SHORT"}),this.intlMessage({intlName:"pikaday.WEDNESDAY_SHORT"}),this.intlMessage({intlName:"pikaday.THURSDAY_SHORT"}),this.intlMessage({intlName:"pikaday.FRIDAY_SHORT"}),this.intlMessage({intlName:"pikaday.SATURDAY_SHORT"})],this.dateIntl.months=[this.intlMessage({intlName:"pikaday.JANUARY"}),this.intlMessage({intlName:"pikaday.FEBRUARY"}),this.intlMessage({intlName:"pikaday.MARCH"}),this.intlMessage({intlName:"pikaday.APRIL"}),this.intlMessage({intlName:"pikaday.MAY"}),this.intlMessage({intlName:"pikaday.JUNE"}),this.intlMessage({intlName:"pikaday.JULY"}),this.intlMessage({intlName:"pikaday.AUGUST"}),this.intlMessage({intlName:"pikaday.SEPTEMBER"}),this.intlMessage({intlName:"pikaday.OCTOBER"}),this.intlMessage({intlName:"pikaday.NOVEMBER"}),this.intlMessage({intlName:"pikaday.DECEMBER"})],this.viewClass="",this.get("container").get("innerHTML")===""&&this.setContainerHTML('<div class="balls"></div>'),this},loadState:function(){if(!this.appContext.flipper.isFlipped("rebootify-stats")||!this.isOwner)return e.Promise.resolve();var t=this,n,r,i,s,o,u,a={};return this.isOwner?this.appContext.getModel("person-models",this.nsid).then(function(f){return t.isPro=f.getValue("isPro"),t.isPro?(n=e.moment().format("X"),r=new e.TimezoneHelper(t.appContext,n,"00:00"),t.dateString||(t.dateString=r.toFormat("YYYY-MM-DD"),t.prettyDateString=r.toFormat("MMM D, YYYY"),t.realtimeDateString=t.dateString),i={date:t.dateString,photoId:t.photoId},s={id:t.statsHelper.getIdFromParams(i)},a.dailyViewsModel=t.appContext.getModel("stats-photo-daily-views-models",s,i),o={date:t.dateString,photoId:t.photoId},u={id:t.statsHelper.getIdFromParams(o)},a.referrerDomainsModel=t.appContext.getModel("stats-referrer-domains-models",u,o),a.photoModel=t.appContext.getModel("photo-models",t.photoId),a.photoStatsModel=t.appContext.getModel("photo-stats-models",t.photoId),(new e.FlickrPromise(a)).then(function(e){t.dailyViewsModel=e.dailyViewsModel,t.referrerDomainsModel=e.referrerDomainsModel,t.photoModel=e.photoModel,t.photoModel.stats=e.photoStatsModel},function(e){console.log(e)})):e.Promise.resolve()}):e.Promise.resolve()},loadNewDateData:function(t){var n=this,r={},i,s;return s={date:t,photoId:n.photoId},i={id:this.statsHelper.getIdFromParams(s)},r.referrerDomainsModel=this.appContext.getModel("stats-referrer-domains-models",i,s),(new e.FlickrPromise(r)).then(function(e){t===n.dateString&&(n.referrerDomainsModel=e.referrerDomainsModel,n.refreshContent())},function(e){console.log(e)})},refreshContent:function(){var e,n=t,r=this.get("container");this.updateCurrentDatePoint(this.dateString,document.querySelector("circle.selectedPoint").getAttribute("key")),this.createReferrersGraphs(),e=r.one(".source-breakdown-right .sources-breakdown"),e&&(n=e.get("clientHeight")),r.setStyles({height:Math.max(t,n+60)+"px"})},buildContainer:function(){var e,t=!1;return this.isPro&&this.appContext.flipper.isFlipped("rebootify-stats")&&this.isOwner&&(t=this.referrerDomainsModel.getValue("total")>0?!0:!1),e=this.templates("stats-photo")({hasStats:this.isPro,hasReferrers:t,prettyDateString:this.dateString===this.realtimeDateString?this.intlMessage({intlName:"stats.TODAY"}):this.prettyDateString,photoUrl:this.photoModel.getSizeToFit({width:100,height:100}).url,url:this.photoModel.getValue("url"),title:this.photoModel.getValue("title"),basicStats:this.photoModel.getValue("engagement").toJSON(),datePosted:this.photoModel.stats.getDateObj("datePosted"),actuallyHasSomeStats:this.dailyViewsModel.getValue("totals").views>0&&this.isPro}),this.setContainerHTML(e),this},activate:function(){if(!this.appContext.flipper.isFlipped("rebootify-stats")||!this.isOwner||!this.isPro)return this;var t=this,n=this.get("container"),r={},i=n.all(".date-picker").getDOMNodes(),s=this.dailyViewsModel.getValue("oldestDate"),o=this.dailyViewsModel.getValue("newestDate"),u=this.dailyViewsModel.getValue("totals");return u.views>0&&this.isPro&&(n.addClass("hasStats"),this.viewClass="."+n.getAttribute("class").replace(/\s/g,"."),this.createMainGraph(),r={i18n:t.dateIntl,position:"bottom right",reposition:!1,format:"YYYY-MM-DD",minDate:e.moment(s).toDate(),maxDate:e.moment(o).toDate(),yearRange:[parseInt(s.substring(0,4),10),parseInt(o.substring(0,4),10)],defaultDate:e.moment(t.dateString).toDate(),setDefaultDate:!0,onSelect:function(e){t.pickaNewDate(e,this.config().theme)},onOpen:function(){this.el.className+=" stats-photo"}},e.use("pikaday",function(e){i.forEach(function(n,i){t.pickers[i]=new e.Pikaday(e.merge(r,{field:n,theme:"picker-"+i}))})}),this.createReferrersGraphs(),this.registerEventHandler(n.all(".photo-stats-nav-link").on("click",this.handleNavItemClick,this)),this.registerEventHandler(n.one(".source-breakdown-left").on("click",this.handleSourceBreakdownClick,this)),this.registerEventHandler(n.one(".source-breakdown-right").on("click",this.handleSourceBreakdownClick
,this)),this.registerEventHandler(n.one(".source-breakdown-right").on("mouseover",this.handleSourceBreakdownListItemMouseover,this)),this.registerEventHandler(n.one(".source-breakdown-right").on("mouseout",this.handleSourceBreakdownListItemMouseout,this))),this},handleNavItemClick:function(n){var r=n.target,i=r.getData("link"),s=this.get("container"),o,u=t,a=!1;r.hasClass("selected")||(s.all(".photo-stats-nav-link").removeClass("selected"),r.addClass("selected"),s.one(".photo-stats-sections").getDOMNode().setAttribute("data-showing",i),i==="sources"?(o=s.one(".source-breakdown-right .sources-breakdown"),o&&(u=o.get("clientHeight"),a=e.config.win.innerWidth<=700,a&&(u=u+140+100+70-60)),s.setStyles({height:Math.max(t,u+60)+"px"})):s.setStyles({height:t+"px"}))},handleSourceBreakdownClick:function(n){var r=n.target,i=r.ancestor(),s=r.getDOMNode(),o=r.getData(),u,a,f=this.get("container"),l,c,h,p,d=".sources-pie-chart",v=f.one(d),m=f.one(".source-breakdown-right"),g,y,b=t,w,E=!1,S,x;if(s.tagName.toLowerCase()==="path")S=this.statsHelper.whichChild(s),i.getDOMNode().classList[0]==="overall"?x=m.all(".referrer-row"):x=m.all(".referrer-row-breakdown-row"),i.getAttribute("referrerkey")!=="other"&&x.getDOMNodes()[S].querySelector(".header").click();else if(r.hasClass("header")){o=i.getData(),g={margin:{top:0,right:0,bottom:0,left:0}},g.width=v.get("clientWidth")-g.margin.left-g.margin.right,g.height=v.get("clientHeight")-g.margin.top-g.margin.bottom,l=this.referrerDomainsModel,c=l.getValue("referrers"),h=l.getValue("totals"),p=Object.keys(h),this.statsHelper.moveToFrontOfArray(p,"flickr"),f.all(".referrer-row-breakdown-row-breakdown-row.shown").replaceClass("shown","not-shown"),f.all(".referrer-row-breakdown-row-breakdown .show-whole-list").removeClass("no-show");if(o.category)y=m.getData("showing"),u=o.category,m.all(".referrer-row").removeClass("selected"),y!==u?(i.addClass("selected"),m.setData("showing",u),f.one(".first-level")&&(e.d3.selectAll(this.viewClass+" .sources-pie-chart .first-level").remove(),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),m.all(".referrer-row-breakdown-row").removeClass("selected"),m.setData("subshowing","NOPE")),this.createOverallPieChart(g,p,h,!0),u==="other"?this.createPieChart("first-level",g,Object.keys(c[u].items),c[u].items,u):this.createPieChart("first-level",g,Object.keys(c[u]),c[u],u)):(m.setData("showing","NOPE"),this.createOverallPieChart(g,p,h,null,null,!1),u==="other"?this.createPieChart("first-level",g,Object.keys(c[u].items),c[u].items,u,null,!0):this.createPieChart("first-level",g,Object.keys(c[u]),c[u],u,null,!0),e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),m.setData("subshowing","NOPE"));else if(o.referrer){y=m.getData("subshowing"),u=o.referrer,a=o.parentcategory,m.all(".referrer-row-breakdown-row").removeClass("selected");if(e.AttributeHelpers.coerceBoolean(o.isempty)){m.setData("subshowing","NOPE"),y!=="NOPE"&&(this.createPieChart("first-level",g,Object.keys(c[a]),c[a],a,null,"fakeOpen"),this.createPieChart("second-level",g,Object.keys(c[a][y].items),c[a][y].items,y,a,!0));return}y!==u?(i.addClass("selected"),m.setData("subshowing",u),f.one(".first-level")&&e.d3.selectAll(this.viewClass+" .sources-pie-chart .second-level").remove(),this.createPieChart("first-level",g,Object.keys(c[a]),c[a],a,null,"fakeClose"),this.createPieChart("second-level",g,Object.keys(c[a][u].items),c[a][u].items,u,a)):(m.setData("subshowing","NOPE"),this.createPieChart("first-level",g,Object.keys(c[a]),c[a],a,null,"fakeOpen"),this.createPieChart("second-level",g,Object.keys(c[a][u].items),c[a][u].items,u,a,!0))}w=f.one(".source-breakdown-right .sources-breakdown"),b=w.get("clientHeight"),E=e.config.win.innerWidth<=700,E&&(b=b+140+100+70-60),f.setStyles({height:Math.max(t,b+60)+"px"})}else r.hasClass("show-whole-list")&&(f.all(".referrer-row-breakdown-row-breakdown-row.not-shown").replaceClass("not-shown","shown"),f.all(".referrer-row-breakdown-row-breakdown .show-whole-list").addClass("no-show"))},handleSourceBreakdownListItemMouseover:function(e){var t=e.target,n=t.ancestor(),r=this.get("container"),i,s;n.hasClass("referrer-row")?(i=this.statsHelper.whichChild(n.getDOMNode()),s=r.one(".source-breakdown-left").all(".pie-chart .overall path"),s.setAttribute("class","not-selected"),s.getDOMNodes()[i].setAttribute("class","")):n.hasClass("referrer-row-breakdown-row")?(i=this.statsHelper.whichChild(n.getDOMNode()),s=r.one(".source-breakdown-left").all(".pie-chart .first-level path"),s.setAttribute("class","not-selected"),s.getDOMNodes()[i].setAttribute("class","")):t.hasClass("referrer-row-breakdown-row-breakdown-row")&&(i=this.statsHelper.whichChild(t.getDOMNode()),s=r.one(".source-breakdown-left").all(".pie-chart .second-level path"),s.setAttribute("class","not-selected"),s.getDOMNodes()[i].setAttribute("class",""))},handleSourceBreakdownListItemMouseout:function(e){var t=e.target;t.getDOMNode().getAttribute("class")!=="pie"&&t.getDOMNode().tagName!=="path"&&this.get("container").all(".source-breakdown-left .pie-chart path").setAttribute("class","")},pickaNewDate:function(t,n){var r=new e.TimezoneHelper(this.appContext,t.getTime()/1e3+Math.abs(t.getTimezoneOffset()*60),"00:00"),i,s;this.dateString=r.toFormat("YYYY-MM-DD"),this.prettyDateString=r.toFormat("MMM D, YYYY");for(i in this.pickers)this.dateString===this.realtimeDateString?s=this.intlMessage({intlName:"stats.TODAY"}):s=this.prettyDateString,s+=" <span></span>",this.pickers[i]._o.field.innerHTML=s,i!==n&&this.pickers[i].setMoment(r.momentObject,!0);this.loadNewDateData(this.dateString)},createMainGraph:function(){function b(t){t.each(function(){var t=e.d3.select(this),n=t.text().split(/\s+/).reverse(),r,i=[],s=0,o=1.1,u=t.attr("y"),a=parseFloat(t.attr("dy")),f=t.text(null).append("tspan").attr("x",0).attr("y",u).attr("dy",a+"em"),l=n.length;while(r=n.pop())i.push(r),f.text(i.join(" ")),l>1&&(i.pop(),f.text(i.join(" ")),i=[r],r!==""&&r!==" "&&(f=t.append("tspan"
).attr("x",0).attr("y",u).attr("dy",s++*o+a+"em").text(r)))})}var t=this.dailyViewsModel,n=t.getValue("days"),r=Object.keys(n),i=t.getValue("newestDate"),s=e.d3.time.format("%Y-%m-%d").parse,o=this,u=this.get("container"),a=".daily-views-graph",f=u.one(a),l,c,h,p,d,v=[],m,g,y="linear";this.daysKeys=r,h={margin:{top:15,right:15,bottom:90,left:60}},h.width=f.get("clientWidth")-h.margin.left-h.margin.right,h.height=f.get("clientHeight")-h.margin.top-h.margin.bottom,o.createYStuff=function(t){var i={};return i.yMin=0,i.yMax=e.d3.max(r,function(e,r){return+n[e][t]}),i.yMax=Math.ceil(i.yMax*1.2),i.yMaxLength=i.yMax.toString().length,i.yAxisDivisor=Math.pow(10,Math.max(0,i.yMaxLength-2)),i.yMax=Math.ceil(i.yMax*.2/i.yAxisDivisor)*i.yAxisDivisor*5,i.yAxisValues=[0,Math.ceil(i.yMax*.2/i.yAxisDivisor)*i.yAxisDivisor,Math.ceil(i.yMax*.4/i.yAxisDivisor)*i.yAxisDivisor,Math.ceil(i.yMax*.6/i.yAxisDivisor)*i.yAxisDivisor,Math.ceil(i.yMax*.8/i.yAxisDivisor)*i.yAxisDivisor,Math.ceil(i.yMax/i.yAxisDivisor)*i.yAxisDivisor],i.y=e.d3.scale.linear().range([h.height,0]).domain([i.yMin,i.yMax]),i.yAxis=e.d3.svg.axis().scale(i.y).orient("left").tickSubdivide(!1).tickValues(i.yAxisValues).tickFormat(function(e,t){var n=e;return t===0&&(n=""),n}),i},g={views:o.createYStuff("views"),favs:o.createYStuff("favs"),comments:o.createYStuff("comments")},r.forEach(function(e,t){v.push(s(e))}),d=e.d3.extent(r,function(e,t){return s(e)}),p=e.d3.time.scale().range([0,h.width]).domain(d),m=e.d3.svg.axis().scale(p).orient("bottom").tickValues(v).tickFormat(function(t,n){var r="";if(n%2===0){r=parseInt(e.d3.time.format("%e")(t),10);if(n===0||r===1||r===2)r+=" "+e.d3.time.format("%b")(t)}return r}),l=e.d3.select(o.viewClass+" "+a).append("svg").attr("class","main-graph").attr("width",h.width+h.margin.left+h.margin.right).attr("height",h.height+h.margin.top+h.margin.bottom).on("mouseleave",function(){e.d3.select(o.viewClass+" .selectedPoint").attr("cx",-100).attr("cy",-100)}),c=l.append("defs"),c.append("linearGradient").attr("id","photoDailyViewsViews").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").selectAll("stop").data([{offset:"0%",color:"#24d9d7"},{offset:"100%",color:"#00aaff"}]).enter().append("stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color}),l.append("g").attr("class","weekends").attr("transform","translate("+h.margin.left+", "+h.margin.top+")").attr("width",h.width).attr("height",h.height).selectAll("rect").data(r).enter().append("rect").attr("class",function(e,t){var n=s(e),r=n.getDay(),i="";if(r===0||r===6)i="weekend";return i}).attr("y",0).attr("x",function(e,t){var n=p(s(e));return t>0&&(n-=h.width/r.length/2),n}).attr("height",h.height).attr("width",function(e,t){var n=h.width/r.length;if(t===0||t===r.length-1)n/=2;return n}),l.append("g").attr("class","gridlines").attr("transform","translate(0, "+h.margin.top+")").selectAll("line").data(g.views.yAxisValues).enter().append("line").attr("x1",0).attr("x2",h.width+h.margin.left+h.margin.right).attr("y1",function(e){return g.views.y(e)}).attr("y2",function(e){return g.views.y(e)}),o.createYAxis=function(t,n){var r=!1;r=e.d3.selectAll(o.viewClass+" .y.axis"),r&&r.remove(),t.insert("g",".x.axis").attr("class","y axis").attr("transform","translate("+h.margin.left+", "+h.margin.top+")").call(g[n].yAxis).selectAll("text").attr("x","-10").attr("y","12")},o.createYAxis(l,"views"),l.append("g").attr("class","x axis").attr("transform","translate("+h.margin.left+", "+(h.height+h.margin.top)+")").call(m).selectAll("text").attr("y","10").call(b),o.createFlatLine=function(){return e.d3.svg.line().x(function(e){return p(s(e))}).y(function(e){return g.views.y(0)})},o.createLine=function(t){return e.d3.svg.line().interpolate(y).x(function(e){return p(s(e))}).y(function(e){return g[t].y(n[e][t])})},o.createArea=function(t){return e.d3.svg.area().interpolate(y).x(function(e){return p(s(e))}).y0(h.height).y1(function(e){return g[t].y(n[e][t])})},l.append("path").attr("class","main-line views").attr("transform","translate("+h.margin.left+", "+h.margin.top+")").attr("d",o.createFlatLine()(r)).attr("stroke","url(#photoDailyViewsViews)").transition().delay(500).duration(500).attr("d",o.createLine("views")(r)),o.updatePoint=function(t,r,i,u){var a=e.d3.select(o.viewClass+" "+t),f=a.attr("cx"),l=a.attr("cy"),c=p(s(r))+h.margin.left,d=g[i].y(n[r][i])+h.margin.top;return u?a.transition().duration(500).attr("cx",c).attr("cy",d).attr("date",r).attr("key",i):a.attr("cx",c).attr("cy",d).attr("date",r).attr("key",i),{point:a,oldXY:[f,l],newXY:[c,d]}},o.updateCurrentDatePoint=function(e,t,n){o.updatePoint(".currentDatePoint",e,t,n)},o.updateSelectedPoint=function(t,n,r){o.updatePoint(".selectedPoint",t,n,r);var i,s,u={};return i={date:t,photoId:o.photoId},s={id:o.statsHelper.getIdFromParams(i)},u.referrerDomainsModel=this.appContext.getModel("stats-referrer-domains-models",s,i),(new e.FlickrPromise(u)).then(function(e){},function(e){console.log(e)})},o.createVoronoi=function(t){var n=!1;n=e.d3.selectAll(o.viewClass+" g.voronoi"),n&&n.remove(),l.insert("g",".selectedPoint").attr("class","voronoi").attr("transform","translate("+h.margin.left+", "+h.margin.top+")").attr("width",h.width+h.width/r.length).attr("height",h.height).selectAll("rect").data(r).enter().append("rect").attr("y",0).attr("x",function(e,t){var n=p(s(e));return n-=h.width/r.length/2,n}).attr("height",h.height).attr("width",function(e,t){return h.width/r.length}).on("mouseenter",function(e,n){o.updateSelectedPoint(r[n],t)})},l.append("circle").attr("class","currentDatePoint").attr("date",i).attr("key","views").attr("r",7).attr("cx",function(e,t){var n=0;return i===o.dateString?n=p(s(i))+h.margin.left:n=p(s(o.dateString))+h.margin.left,n}).attr("cy",g.views.y(0)+h.margin.top).transition().delay(500).duration(500).attr("cy",function(e,t){var r=0;return i===o.dateString?r=g.views.y(n[i].views)+h.margin.top:r=g.views.y(n[o.dateString].views)+h.margin.top,r}),l.append("circle"
).attr("class","selectedPoint").attr("cx",-100).attr("cy",-100).attr("r",4).attr("date",i).attr("key","views").on("click",function(){o.pickaNewDate(new Date(this.getAttribute("date")))}).on("mouseenter",function(t,r){var i=this.getAttribute("date"),s=n[i],a=new Date(i),f=new e.TimezoneHelper(o.appContext,a.getTime()/1e3+Math.abs(a.getTimezoneOffset()*60),"00:00"),l=f.toFormat("MMMM D"),c,h=150,p,d=s.views;s.favs>d&&(d=s.favs),s.comments>d&&(d=s.comments),h+=(d.toString().length-1)*20,p=-(h/2)+3,c='<div class="date">'+l+"</div>"+'<div class="stats">'+'<div class="stat">'+'<i class="icon" data-type="views"></i>'+o.intlMessage({intlName:"stats.NUMBER",num:s.views})+"</div>"+'<div class="stat">'+'<i class="icon" data-type="faves"></i>'+o.intlMessage({intlName:"stats.NUMBER",num:s.favs})+"</div>"+'<div class="stat">'+'<i class="icon" data-type="comments"></i>'+o.intlMessage({intlName:"stats.NUMBER",num:s.comments})+"</div>"+"</div>",o.tooltip?o.tooltip.updateHTMLMessage(c):(o.tooltip=new e.Views.FluidDroparound({appContext:o.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showDropArrow:!0,preferredSide:"bottom-middle",width:h,height:60,classList:"photo-daily-stats-tooltip over-modal",anchorElement:u.one(".selectedPoint"),hideModalOverlay:!0,invisibleOverlay:!0,htmlMessage:c,contentPadding:0,anchorOffsetHorizontal:p,anchorOffsetVertical:72,closeOnScroll:!0}),o.tooltip.show())}).on("mouseleave",function(e){o.tooltip&&(o.tooltip.close(),o.tooltip=undefined)}),o.createVoronoi("views")},createReferrersGraphs:function(){var e=this,t=this.referrerDomainsModel,n=t.getValue("referrers"),r,i=t.getValue("total"),s=t.getValue("totals"),o,u=this.get("container"),a=".sources-pie-chart",f=u.one(a),l=u.one(".source-breakdown-left"),c=u.one(".source-breakdown-right"),h=f.one(".overall"),p,d,v="";c.setData("showing","NOPE"),c.setData("subshowing","NOPE"),parseInt(i,10)===0?(l.addClass("no-results"),c.addClass("no-results")):(l.removeClass("no-results"),c.removeClass("no-results"),r=Object.keys(n),this.statsHelper.moveToFrontOfArray(r,"flickr"),this.statsHelper.moveToEndOfArray(r,"other"),o=Object.keys(s),this.statsHelper.moveToFrontOfArray(o,"flickr"),this.statsHelper.moveToEndOfArray(o,"other"),d={margin:{top:0,right:0,bottom:0,left:0}},d.width=f.get("clientWidth")-d.margin.left-d.margin.right,d.height=f.get("clientHeight")-d.margin.top-d.margin.bottom,this.set("outerRadius",d.height/2),h?p=e.createOverallPieChart(d,o,s,!1,!0):p=e.createOverallPieChart(d,o,s),v='<div class="referrer-rows">',o.forEach(function(t,n){v+='<div class="referrer-row" data-category="'+t+'">',v+='<div class="header">',v+='<div><span class="dot"></span>'+t+'<span class="caret"></span></div>',v+="<div>"+e.intlMessage({intlName:"stats.NUMBER",num:s[t]})+"</div>",v+="<div>"+Math.round(s[t]/i*100)+"%</div>",v+="</div>",v+="</div>"}),v+="</div>",c.one(".sources-breakdown-list").empty().append(v),r.forEach(function(t,r){var i="",o,u,a;t==="other"?(o=n[t].items,u=Object.keys(o),a=s[t],typeof a.viewcount!="undefined"&&(a=a.viewcount),i='<div class="referrer-row-breakdown" data-index="'+r+'" data-group="'+t+'">'+e.createOtherReferrerListRowsHTML(u,o,a,t)+"</div>"):(o=n[t],u=Object.keys(o),a=s[t],i='<div class="referrer-row-breakdown" data-index="'+r+'" data-group="'+t+'">'+e.createReferrerListRowsHTML(u,o,a,t)+"</div>"),c.one('.referrer-row[data-category="'+t+'"]').append(i)}))},createOverallPieChart:function(t,n,r,i,s){i||(i=!1);var o,u,a,f,l=this.get("outerRadius"),c=this.get("innerRadius"),h=501,p=this.get("container"),d=".sources-pie-chart",v=p.one(d).one("svg .overall"),m,g=0;n.forEach(function(e){var t=r[e];typeof t.viewcount!="undefined"&&(t=t.viewcount),g+=t}),m=e.d3.scale.linear().domain([1,n.length]).range(["#00aaff","#18297f"]),u=e.d3.svg.arc().innerRadius(c).outerRadius(l),s&&v&&(e.d3.select(this.viewClass+" "+d+" svg").remove(),v=!1),v?i?(a=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(-2*Math.PI).value(function(e,t){var n=r[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),o=e.d3.select(this.viewClass+" "+d+" svg .overall"),f=o.datum(n).selectAll("path").call(function(t){t.transition().delay(function(e,t){var i=0,s=0,o=0;if(t>0){for(o=t-1;o>=0;--o)typeof r[n[o]].viewcount!="undefined"?s+=r[n[o]].viewcount:s+=r[n[o]];i=s/g*h}return i}).duration(function(e,t){var n=0;return n=e.value/g*h,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.startAngle=n(e),u(t)}})})):(a=e.d3.layout.pie().startAngle(2*Math.PI).endAngle(0*Math.PI).value(function(e,t){var n=r[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),o=e.d3.select(this.viewClass+" "+d+" svg .overall"),f=o.selectAll("path"),f.data().map(function(e,t){e.startAngle=e.originalStartAngle,e.endAngle=e.originalEndAngle}),f.call(function(t){t.transition().delay(function(e,t){var i=0,s=0,o=0;for(o=t+1;o<n.length;o++)typeof r[n[o]].viewcount!="undefined"?s+=r[n[o]].viewcount:s+=r[n[o]];return i=s/g*h,i}).duration(function(e,t){var n=0;return n=e.value/g*h,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.startAngle=n(e),u(t)}})}),e.d3.select(this.viewClass+" "+d+" svg text").text(g)):(a=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value(function(e,t){var n=r[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),o=e.d3.select(this.viewClass+" "+d).append("svg").attr("class","pie").attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom).append("g").attr("class","overall").attr("height",t.height+t.margin.top+t.margin.bottom).attr("width",l*2).attr("transform","translate("+t.width/2+", "+l+")"),f=o.datum(n).selectAll("path").data(a).enter().append("path").attr("data-source",function(e){return e.data}).on("mouseenter",function(e,t){var n=this.get("container"),r,i;r=n.all(".source-breakdown-right .referrer-row"),i=n
.all(".source-breakdown-left .pie-chart .overall path"),r.removeClass("temp-selected"),r.getDOMNodes()[t].setAttribute("class",r.getDOMNodes()[t].getAttribute("class")+" temp-selected"),i.setAttribute("class","not-selected"),i.getDOMNodes()[t].setAttribute("class","")}.bind(this)).on("mouseleave",function(e,t){var n=this.get("container"),r,i;r=n.all(".source-breakdown-right .referrer-row"),i=n.all(".source-breakdown-left .pie-chart .overall path"),r.removeClass("temp-selected"),i.setAttribute("class","")}.bind(this)).transition().delay(function(e,t){var i=0,s=0,o=0;if(t>0){for(o=t-1;o>=0;--o)typeof r[n[o]].viewcount!="undefined"?s+=r[n[o]].viewcount:s+=r[n[o]];i=s/g*h}return i}).duration(function(e,t){var n=0;return n=e.value/g*h,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=n(e),u(t)}}).each("end",function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle}),o.append("text").attr("transform","translate(0, 5)").attr("fill-opacity",0).text(g).transition().delay(h/2).duration(h/2).attr("fill-opacity",1))},createPieChart:function(t,n,r,i,s,o,u){u||(u=!1);var a,f,l,c,h=this.get("outerRadius"),p=this.get("innerRadius"),d=501,v=this.get("container"),m=".sources-pie-chart",g=v.one(m).one("svg ."+t),y,b=0,w=r.length;return r.forEach(function(e){var t=i[e];typeof t.viewcount!="undefined"&&(t=t.viewcount),b+=t}),y=e.d3.scale.linear().domain([1,r.length]).range(["#00aaff","#18297f"]),f=e.d3.svg.arc().innerRadius(p).outerRadius(h),g?u===!0?b===0?(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value(function(e,t){return 1}).sort(null),a=e.d3.select(this.viewClass+" "+m+" svg ."+t),c=a.datum(r).selectAll("path").call(function(t){t.transition().delay(function(e,t){var n=0,i=0,s=0;for(s=t+1;s<r.length;s++)i+=1;return n=i/w*d,n}).duration(function(e,t){var n=0;return n=e.value/w*d,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.endAngle=n(e),f(t)}}).each("end",function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle})})):(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value(function(e,t){var n=i[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),a=e.d3.select(this.viewClass+" "+m+" svg ."+t),c=a.datum(r).selectAll("path").call(function(t){t.transition().delay(function(e,t){var n=0,s=0,o=0;for(o=t+1;o<r.length;o++)typeof i[r[o]].viewcount!="undefined"?s+=i[r[o]].viewcount:s+=i[r[o]];return n=s/b*d,n}).duration(function(e,t){var n=0;return n=e.value/b*d,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.endAngle=n(e),f(t)}}).each("end",function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle})})):u==="fakeClose"?(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(-2*Math.PI).value(function(e,t){var n=i[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),a=e.d3.select(this.viewClass+" "+m+" svg ."+t),c=a.datum(r).selectAll("path").call(function(t){t.transition().delay(function(e,t){var n=0,s=0,o=0;if(t>0){for(o=t-1;o>=0;--o)typeof i[r[o]].viewcount!="undefined"?s+=i[r[o]].viewcount:s+=i[r[o]];n=s/b*d}return n}).duration(function(e,t){var n=0;return n=e.value/b*d,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.startAngle=n(e),f(t)}})})):(l=e.d3.layout.pie().startAngle(2*Math.PI).endAngle(0*Math.PI).value(function(e,t){var n=i[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),a=e.d3.select(this.viewClass+" "+m+" svg ."+t),c=a.selectAll("path"),c.data().map(function(e,t){e.startAngle=e.originalStartAngle,e.endAngle=e.originalEndAngle}),c.call(function(t){t.transition().delay(function(e,t){var n=0,s=0,o=0;for(o=t+1;o<r.length;o++)typeof i[r[o]].viewcount!="undefined"?s+=i[r[o]].viewcount:s+=i[r[o]];return n=s/b*d,n}).duration(function(e,t){var n=0;return n=e.value/b*d,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.endAngle,t.startAngle);return function(e){return t.startAngle=n(e),f(t)}})}),e.d3.select(this.viewClass+" "+m+" svg text").text(b)):(b===0?(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value(function(e,t){return 1}).sort(null),a=e.d3.select(this.viewClass+" "+m+" svg").append("g").attr("class",t).attr("referrerkey",s).attr("parentreferrerkey",o).attr("height",n.height+n.margin.top+n.margin.bottom).attr("width",h*2).attr("transform","translate("+n.width/2+", "+h+")"),c=a.datum(r).selectAll("path").data(l).enter().append("path").attr("data-source",function(e){var t=e.data;if(s==="flickr"||s==="other")t="";return t}).attr("fill",function(e,t){var n="";if(s==="flickr"||s==="other"||o)n=y(t);return n}).transition().delay(function(e,t){var n=0,r=0,i=0;if(t>0){for(i=t-1;i>=0;--i)r+=1;n=r/w*d}return n}).duration(function(e,t){var n=0;return n=e.value/w*d,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=n(e),f(t)}}).each("end",function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle})):(l=e.d3.layout.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value(function(e,t){var n=i[e];return typeof n.viewcount!="undefined"&&(n=n.viewcount),n}).sort(null),a=e.d3.select(this.viewClass+" "+m+" svg").append("g").attr("class",t).attr("referrerkey",s).attr("parentreferrerkey",o).attr("height",n.height+n.margin.top+n.margin.bottom).attr("width",h*2).attr("transform","translate("+n.width/2+", "+h+")"),c=a.datum(r).selectAll("path").data(l).enter().append("path").attr("data-source",function(e){var t=e.data;if(s==="flickr"||s==="other")t="";return t}).attr("fill",function(e,t){var n="";if(s==="flickr"||s==="other"||o)n=y(t);return n}).on("mouseenter",function(e,n){var r=this.get("container"),i,u,a;o?(i=r.all('.source-breakdown-right .referrer-row .referrer-row-breakdown-row[data-parentcategory="'+
o+'"][data-referrer="'+s+'"] .referrer-row-breakdown-row-breakdown-row:not(.not-shown)'),u=r.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+s+'"] path'),i.removeClass("selected"),a=i.getDOMNodes()[n],a&&a.setAttribute("class","referrer-row-breakdown-row-breakdown-row temp-selected")):(i=r.all('.source-breakdown-right .referrer-row .referrer-row-breakdown[data-group="'+s+'"] .referrer-row-breakdown-row'),u=r.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+s+'"] path'),i.removeClass("selected"),i.getDOMNodes()[n].setAttribute("class","referrer-row-breakdown-row temp-selected")),u.setAttribute("class","not-selected"),u.getDOMNodes()[n].setAttribute("class","")}.bind(this)).on("mouseleave",function(e,n){var r=this.get("container"),i,u;o?(i=r.all('.source-breakdown-right .referrer-row .referrer-row-breakdown-row[data-parentcategory="'+o+'"][data-referrer="'+s+'"] .referrer-row-breakdown-row-breakdown-row'),u=r.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+s+'"] path')):(i=r.all('.source-breakdown-right .referrer-row .referrer-row-breakdown[data-group="'+s+'"] .referrer-row-breakdown-row'),u=r.all(".source-breakdown-left .pie-chart ."+t+'[referrerkey="'+s+'"] path')),i.removeClass("temp-selected"),u.setAttribute("class","")}.bind(this)).transition().delay(function(e,t){var n=0,s=0,o=0;if(t>0){for(o=t-1;o>=0;--o)typeof i[r[o]].viewcount!="undefined"?s+=i[r[o]].viewcount:s+=i[r[o]];n=s/b*d}return n}).duration(function(e,t){var n=0;return n=e.value/b*d,n}).ease("linear").attrTween("d",function(t){var n=e.d3.interpolate(t.startAngle,t.endAngle);return function(e){return t.endAngle=n(e),f(t)}}).each("end",function(e,t){e.originalStartAngle=e.startAngle,e.originalEndAngle=e.endAngle})),e.d3.select(this.viewClass+" "+m+" svg text").text(b)),a},createReferrerBreakdownListRowsHTML:function(t,n,r,i){var s=this,o="",u,a,f=5;return u=Object.keys(t),a=e.d3.scale.linear().domain([0,u.length-1]).range(["#00aaff","#18297f"]),o='<div class="referrer-row-breakdown-row-breakdown">',u.forEach(function(e,r){var i,u,l,c="",h=!1,p=t[e].viewcount;i="referrer-row-breakdown-row-breakdown-row",r>=f&&(i+=" not-shown"),u=t[e].displaytext;if(u.toLowerCase()==="direct"||u==="/")t[e].platform&&(u=t[e].platform.split(".")[1]),t[e].link&&t[e].link!==""&&t[e].link!=="/"&&(u=t[e].link);t[e].link&&t[e].link!==""&&t[e].link!=="/"&&(h=!0,l=t[e].link),c=' style="background: '+a(r)+';"',h?o+='<a class="'+i+'" title="'+u+'" href="'+l+'" target="_blank">':o+='<div class="'+i+'" title="'+u+'">',o+='<div><span class="dot"'+c+"></span>"+u+"</div>",o+="<div>"+s.intlMessage({intlName:"stats.NUMBER",num:p})+"</div>",o+="<div>"+Math.round(p/n*100)+"%</div>",h?o+="</a>":o+="</div>"}),u.length>f&&(o+='<div class="show-whole-list">'+s.intlMessage({intlName:"stats.SHOW_ALL"})+"</div>"),o+="</div>",o},createReferrerListRowsHTML:function(t,n,r,i){var s="",o=this,u,a="";return u=e.d3.scale.linear().domain([0,t.length-1]).range(["#00aaff","#18297f"]),t.forEach(function(e,t){var f=n[e],l=e;l.toLowerCase()==="sets"&&(l="Albums"),typeof f.viewcount!="undefined"&&(f=f.viewcount);if(i==="flickr"||i==="other")a=' style="background: '+u(t)+';"';s+='<div class="referrer-row-breakdown-row" title="'+l+'" data-parentcategory="'+i+'" data-referrer="'+e+'" data-isempty="'+!n[e].items+'">',s+='<div class="header">',n[e].items?s+='<div><span class="dot"'+a+"></span>"+l+'<span class="caret"></span></div>':s+='<div><span class="dot"'+a+"></span>"+l+"</div>",s+="<div>"+o.intlMessage({intlName:"stats.NUMBER",num:f})+"</div>",r>0?s+="<div>"+Math.round(f/r*100)+"%</div>":s+="<div>0%</div>",s+="</div>",n[e].items&&(s+=o.createReferrerBreakdownListRowsHTML(n[e].items,f,i,e)),s+="</div>"}),s},createOtherReferrerListRowsHTML:function(t,n,r,i){var s=this,o="",u;return u=e.d3.scale.linear().domain([0,t.length-1]).range(["#00aaff","#18297f"]),t.forEach(function(e,t){var a,f,l="",c=!1,h=n[e].viewcount;a=n[e].displaytext;if(a.toLowerCase()==="direct"||a==="/")n[e].platform&&(a=n[e].platform.split(".")[1]),n[e].link&&n[e].link!==""&&n[e].link!=="/"&&(a=n[e].link);n[e].link&&n[e].link!==""&&n[e].link!=="/"&&(c=!0,f=n[e].link),l=' style="background: '+u(t)+';"',c?o+='<a class="referrer-row-breakdown-row" title="'+a+'" href="'+f+'" target="_blank" data-parentcategory="'+i+'">':o+='<div class="referrer-row-breakdown-row" title="'+a+'" data-parentcategory="'+i+'">',o+='<div class="header">',o+='<div><span class="dot"'+l+"></span>"+a+'<span class="caret"></span></div>',o+="<div>"+s.intlMessage({intlName:"stats.NUMBER",num:h})+"</div>",o+="<div>"+Math.round(h/r*100)+"%</div>",o+="</div>",c?o+="</a>":o+="</div>"}),o},destructor:function(){this.tooltip&&this.tooltip.close()}},{ATTRS:{innerRadius:{value:29},outerRadius:{value:0}}})},"@VERSION@",{requires:["flickr-view","flickrui-css","hermes-template-stats-photo","photo-sidebar-actions-css","stats-photo-css","pikaday-css","moment","timezone-helper","stats-helper","photo-models","photo-engagement-models","photo-stats-models","stats-photo-daily-views-models","stats-referrer-domains-models"],optionalRequires:["d3","pikaday"],optional:[],langBundles:["common","stats","pikaday","photo-page-scrappy"]});
YUI.add("hermes-lang-stats",function(e,t){e.Intl.add("hermes/stats","en-US",{STATS:["Stats"],NUMBER:[{type:"number",valueName:"num"}],NUMBER_VIEWS:[{type:"number",valueName:"num"}," views"],NUMBER_FAVES:[{type:"number",valueName:"num"}," faves"],NUMBER_COMMENTS:[{type:"number",valueName:"num"}," comments"],VIEW_COUNTS:["View Counts"],SO_FAR_TODAY:["So far today"],SO_FAR_TODAY_DOT_DOT_DOT:["So far today..."],YESTERDAY:["Yesterday"],ALL_TIME:["All time"],PHOTOS_AND_VIDEOS:["Photos and Videos"],PHOTOS:["Photos"],VIDEOS:["Videos"],PHOTOSTREAM:["Photostream"],ALBUMS:["Albums"],COLLECTIONS:["Collections"],GALLERIES:["Galleries"],TOTAL:["Total"],TOP_PHOTOS_AND_VIDEOS:["Top photos and videos"],CONTENT_BREAKDOWN:["Content Breakdown <span>(",{type:"number",valueName:"num"}," items)</span>"],VIEWS:["Views"],ALL_TIME_VIEWS:["All Time views"],ALL_TIME_FAVES:["All time faves"],ALL_TIME_COMMENTS:["All time comments"],DATE:["Date"],INTERESTINGNESS:["Interestingness"],FAVORITES:["Favorites"],COMMENTS:["Comments"],RECENT_VIEWS:["Recent views"],RECENT_FAVES:["Recent faves"],RECENT_COMMENTS:["Recent comments"],BACK_TO_STATS:["Back to Stats"],SOURCE_BREAKDOWN:["Source breakdown"],ALL_PHOTO_AND_VIDEOS_LINK:["All photos and videos"],VISITS:["Visits"],PRO_UNTIL_DATE:["PRO until ","${date}"],PRO_SINCE_DATE:["PRO since ","${date}"],LEARN_MORE:["Learn more"],CURRENT_STATS_DATE:["Stats are shown in GMT, where it's currently ","${time}"," on ","${date}"],SPACE_USED_LIMITED:["${used}"," of ","${total}"," used"],SPACE_USED_UNLIMITED:["${used}"," of unlimited used"],PUBLIC:["Public"],FRIENDS:["Friends"],FAMILY:["Family"],FF:["Friends and Family"],PRIVATE:["Private"],TAGGED:["Tagged"],GEOTAGGED:["Geotagged"],IN_ALBUMS:["In albums"],IN_GROUPS:["In groups"],VIEWED:["Viewed"],FAVED:["Faved"],COMMENTED:["Commented"],NO_SOURCES_TODAY:["No sources for this day"],NO_VIEWS_TODAY:["No photos have been viewed today"],PERCENTAGE_OF_VIEWS:[{type:"number",valueName:"num"},"% of views"],PERCENTAGE_OF_FAVES:[{type:"number",valueName:"num"},"% of faves"],PERCENTAGE_OF_COMMENTS:[{type:"number",valueName:"num"},"% of comments"],TODAY:["Today"],SOURCES:["Sources"],LOAD_MORE:["Load more"],NEXT:["Next"],PREVIOUS:["Previous"],MEDIA:["Media"],VISIBILITY:["Visibility"],ALPHA_LABEL:["Stats Alpha"],BETA_LABEL:["Stats Beta"],SHOW_ALL:["Show all"],PHOTO_STATS:["Photo stats"],EXPAND_ALL:["Expand all"],COLLAPSE_ALL:["Collapse all"],NO_PHOTO_STATS_AVAILABLE:["No stats available for this photo"],NO_RECENT_PHOTO_STATS_AVAILABLE:["No recent stats available for this photo"],WELCOME_TO_STATS:["Welcome to stats"],WELCOME_MODAL_SCREEN_1:["Easily see your all time data"],WELCOME_MODAL_SCREEN_2:["More powerful navigation"],WELCOME_MODAL_SCREEN_3:["More meaningful data, categories, and social sources"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-pikaday",function(e,t){e.Intl.add("hermes/pikaday","en-US",{DATE_FORMAT:["MM-DD-YYYY"],PREVIOUS_MONTH:["Previous Month"],NEXT_MONTH:["Next Month"],JANUARY:["January"],FEBRUARY:["February"],MARCH:["March"],APRIL:["April"],MAY:["May"],JUNE:["June"],JULY:["July"],AUGUST:["August"],SEPTEMBER:["September"],OCTOBER:["October"],NOVEMBER:["November"],DECEMBER:["December"],SUNDAY:["Sunday"],MONDAY:["Monday"],TUESDAY:["Tuesday"],WEDNESDAY:["Wednesday"],THURSDAY:["Thursday"],FRIDAY:["Friday"],SATURDAY:["Saturday"],SUNDAY_SHORT:["S"],MONDAY_SHORT:["M"],TUESDAY_SHORT:["T"],WEDNESDAY_SHORT:["W"],THURSDAY_SHORT:["T"],FRIDAY_SHORT:["F"],SATURDAY_SHORT:["S"]})},"@VERSION@",{requires:["intl"]});
YUI.add("pikaday",function(e,t){typeof window!="undefined"&&(this.moment=window.moment),
/*!
 * Pikaday
 *
 * Copyright  2014 David Bushell | BSD & MIT license | https://github.com/dbushell/Pikaday
 */
function(e,t){"use strict";var n;if(typeof exports=="object"){try{n=require("moment")}catch(r){}module.exports=t(n)}else typeof define=="function"&&define.amd?define(function(e){var r="moment";try{n=e(r)}catch(i){}return t(n)}):e.Pikaday=t(e.moment)}(this,function(e){"use strict";var t=typeof e=="function",n=!!window.addEventListener,r=window.document,i=window.setTimeout,s=function(e,t,r,i){n?e.addEventListener(t,r,!!i):e.attachEvent("on"+t,r)},o=function(e,t,r,i){n?e.removeEventListener(t,r,!!i):e.detachEvent("on"+t,r)},u=function(e,t,n){var i;r.createEvent?(i=r.createEvent("HTMLEvents"),i.initEvent(t,!0,!1),i=b(i,n),e.dispatchEvent(i)):r.createEventObject&&(i=r.createEventObject(),i=b(i,n),e.fireEvent("on"+t,i))},a=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},f=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!==-1},l=function(e,t){f(e,t)||(e.className=e.className===""?t:e.className+" "+t)},c=function(e,t){e.className=a((" "+e.className+" ").replace(" "+t+" "," "))},h=function(e){return/Array/.test(Object.prototype.toString.call(e))},p=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},d=function(e){var t=e.getDay();return t===0||t===6},v=function(e){return e%4===0&&e%100!==0||e%400===0},m=function(e,t){return[31,v(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},g=function(e){p(e)&&e.setHours(0,0,0,0)},y=function(e,t){return e.getTime()===t.getTime()},b=function(e,t,n){var r,i;for(r in t){i=e[r]!==undefined;if(i&&typeof t[r]=="object"&&t[r]!==null&&t[r].nodeName===undefined)p(t[r])?n&&(e[r]=new Date(t[r].getTime())):h(t[r])?n&&(e[r]=t[r].slice(0)):e[r]=b({},t[r],n);else if(n||!i)e[r]=t[r]}return e},w=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month>11&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},E={field:null,bound:undefined,position:"bottom left",reposition:!0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:undefined,maxMonth:undefined,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,mainCalendar:"left",container:undefined,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},S=function(e,t,n){t+=e.firstDay;while(t>=7)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},x=function(e,t,n,r,i,s,o){if(o)return'<td class="is-empty"></td>';var u=[];return s&&u.push("is-disabled"),i&&u.push("is-today"),r&&u.push("is-selected"),'<td data-day="'+e+'" class="'+u.join(" ")+'">'+'<button class="pika-button pika-day" type="button" '+'data-pika-year="'+n+'" data-pika-month="'+t+'" data-pika-day="'+e+'">'+e+"</button>"+"</td>"},T=function(e,t,n){var r=new Date(n,0,1),i=Math.ceil(((new Date(n,t,e)-r)/864e5+r.getDay()+1)/7);return'<td class="pika-week">'+i+"</td>"},N=function(e,t){return"<tr>"+(t?e.reverse():e).join("")+"</tr>"},C=function(e){return"<tbody>"+e.join("")+"</tbody>"},k=function(e){var t,n=[];e.showWeekNumber&&n.push("<th></th>");for(t=0;t<7;t++)n.push('<th scope="col"><abbr title="'+S(e,t)+'">'+S(e,t,!0)+"</abbr></th>");return"<thead>"+(e.isRTL?n.reverse():n).join("")+"</thead>"},L=function(e,t,n,r,i){var s,o,u,a=e._o,f=n===a.minYear,l=n===a.maxYear,c='<div class="pika-title">',p,d,v=!0,m=!0;for(u=[],s=0;s<12;s++)u.push('<option value="'+(n===i?s-t:12+s-t)+'"'+(s===r?" selected":"")+(f&&s<a.minMonth||l&&s>a.maxMonth?"disabled":"")+">"+a.i18n.months[s]+"</option>");p='<div class="pika-label">'+a.i18n.months[r]+'<select class="pika-select pika-select-month">'+u.join("")+"</select></div>",h(a.yearRange)?(s=a.yearRange[0],o=a.yearRange[1]+1):(s=n-a.yearRange,o=1+n+a.yearRange);for(u=[];s<o&&s<=a.maxYear;s++)s>=a.minYear&&u.push('<option value="'+s+'"'+(s===n?" selected":"")+">"+s+"</option>");return d='<div class="pika-label">'+n+a.yearSuffix+'<select class="pika-select pika-select-year">'+u.join("")+"</select></div>",a.showMonthAfterYear?c+=d+p:c+=p+d,f&&(r===0||a.minMonth>=r)&&(v=!1),l&&(r===11||a.maxMonth<=r)&&(m=!1),t===0&&(c+='<button class="pika-prev'+(v?"":" is-disabled")+'" type="button">'+a.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(c+='<button class="pika-next'+(m?"":" is-disabled")+'" type="button">'+a.i18n.nextMonth+"</button>"),c+="</div>"},A=function(e,t){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+k(e)+C(t)+"</table>"},O=function(o){var u=this,a=u.config(o);u._onMouseDown=function(e){if(!u._v)return;e=e||window.event;var t=e.target||e.srcElement;if(!t)return;if(!f(t,"is-disabled")){if(f(t,"pika-button")&&!f(t,"is-empty")){u.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),a.bound&&i(function(){u.hide(),a.field&&a.field.blur()},100);return}f(t,"pika-prev")?u.prevMonth():f(t,"pika-next")&&u.nextMonth()}if(!f(t,"pika-select")){if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}else u._c=!0},u._onChange=function(e){e=e||window.event;var t=e.target||e.srcElement;if(!t)return;f(t,"pika-select-month")?u.gotoMonth(t.value):f(t,"pika-select-year")&&u.gotoYear(t.value)},u._onInputChange=function(n){var r;if(n.firedBy===u)return;t?(r=e(a.field.value,a.format),r=r&&r.isValid()?r.toDate():null):r=new Date(Date.parse(a.field.value)),u.setDate(p(r)?r:null),u._v||u.show()},u._onInputFocus=function(){u.show()},u._onInputClick=function(){u.show()},u._onInputBlur=function(){var e=r.activeElement;do if(f(e,"pika-single"))return;while(e=e.parentNode);u._c||(u._b=i(function(){u.hide()},50)),u._c=!1},u._onClick=
function(e){e=e||window.event;var t=e.target||e.srcElement,r=t;if(!t)return;!n&&f(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),s(t,"change",u._onChange)));do if(f(r,"pika-single")||r===a.trigger)return;while(r=r.parentNode);u._v&&t!==a.trigger&&r!==a.trigger&&u.hide()},u.el=r.createElement("div"),u.el.className="pika-single"+(a.isRTL?" is-rtl":""),s(u.el,"mousedown",u._onMouseDown,!0),s(u.el,"change",u._onChange),a.field&&(a.container?a.container.appendChild(u.el):a.bound?r.body.appendChild(u.el):a.field.parentNode.insertBefore(u.el,a.field.nextSibling),s(a.field,"change",u._onInputChange),a.defaultDate||(t&&a.field.value?a.defaultDate=e(a.field.value,a.format).toDate():a.defaultDate=new Date(Date.parse(a.field.value)),a.setDefaultDate=!0));var l=a.defaultDate;p(l)?a.setDefaultDate?u.setDate(l,!0):u.gotoDate(l):u.gotoDate(new Date),a.bound?(this.hide(),u.el.className+=" is-bound",s(a.trigger,"click",u._onInputClick),s(a.trigger,"focus",u._onInputFocus),s(a.trigger,"blur",u._onInputBlur)):this.show()};return O.prototype={config:function(e){this._o||(this._o=b({},E,!0));var t=b(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.bound=!!(t.bound!==undefined?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn=typeof t.disableDayFn=="function"?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;t.numberOfMonths=n>4?4:n,p(t.minDate)||(t.minDate=!1),p(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&(g(t.minDate),t.minYear=t.minDate.getFullYear(),t.minMonth=t.minDate.getMonth()),t.maxDate&&(g(t.maxDate),t.maxYear=t.maxDate.getFullYear(),t.maxMonth=t.maxDate.getMonth());if(h(t.yearRange)){var r=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||r,t.yearRange[1]=parseInt(t.yearRange[1],10)||r}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||E.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(n){return p(this._d)?t?e(this._d).format(n||this._o.format):this._d.toDateString():""},getMoment:function(){return t?e(this._d):null},setMoment:function(n,r){t&&e.isMoment(n)&&this.setDate(n.toDate(),r)},getDate:function(){return p(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",u(this._o.field,"change",{firedBy:this})),this.draw();typeof e=="string"&&(e=new Date(Date.parse(e)));if(!p(e))return;var n=this._o.minDate,r=this._o.maxDate;p(n)&&e<n?e=n:p(r)&&e>r&&(e=r),this._d=new Date(e.getTime()),g(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),u(this._o.field,"change",{firedBy:this})),!t&&typeof this._o.onSelect=="function"&&this._o.onSelect.call(this,this.getDate())},gotoDate:function(e){var t=!0;if(!p(e))return;if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),r=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),i=e.getTime();r.setMonth(r.getMonth()+1),r.setDate(r.getDate()-1),t=i<n.getTime()||r.getTime()<i}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],this._o.mainCalendar==="right"&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()},adjustCalendars:function(){this.calendars[0]=w(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=w({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){this._o.minDate=e},setMaxDate:function(e){this._o.maxDate=e},draw:function(e){if(!this._v&&!e)return;var t=this._o,n=t.minYear,r=t.maxYear,s=t.minMonth,o=t.maxMonth,u="";this._y<=n&&(this._y=n,!isNaN(s)&&this._m<s&&(this._m=s)),this._y>=r&&(this._y=r,!isNaN(o)&&this._m>o&&(this._m=o));for(var a=0;a<t.numberOfMonths;a++)u+='<div class="pika-lendar">'+L(this,a,this.calendars[a].year,this.calendars[a].month,this.calendars[0].year)+this.render(this.calendars[a].year,this.calendars[a].month)+"</div>";this.el.innerHTML=u,t.bound&&t.field.type!=="hidden"&&i(function(){t.trigger.focus()},1);if(typeof this._o.onDraw=="function"){var f=this;i(function(){f._o.onDraw.call(f)},0)}},adjustPosition:function(){if(this._o.container)return;var e=this._o.trigger,t=e,n=this.el.offsetWidth,i=this.el.offsetHeight,s=window.innerWidth||r.documentElement.clientWidth,o=window.innerHeight||r.documentElement.clientHeight,u=window.pageYOffset||r.body.scrollTop||r.documentElement.scrollTop,a,f,l;if(typeof e.getBoundingClientRect=="function")l=e.getBoundingClientRect(),a=l.left+window.pageXOffset,f=l.bottom+window.pageYOffset;else{a=t.offsetLeft,f=t.offsetTop+t.offsetHeight;while(t=t.offsetParent)a+=t.offsetLeft,f+=t.offsetTop}if(this._o.reposition&&a+n>s||this._o.position.indexOf("right")>-1&&a-n+e.offsetWidth>0)a=a-n+e.offsetWidth;if(this._o.reposition&&f+i>o+u||this._o.position.indexOf("top")>-1&&f-i-e.offsetHeight>0)f=f-i-e.offsetHeight;this.el.style.cssText=["position: absolute","left: "+a+"px","top: "+f+"px"].join(";")},render:function(e,t){var n=this._o,r=new Date,i=m(e,t),s=(new Date(e,t,1)).getDay(),o=[],u=[];g(r),n.firstDay>0&&(s-=n.firstDay,s<0&&(s+=7));var a=i+s,f=a;while(f>7)f-=7;a+=7-f;for(var l=0,c=0;l<a;l++){var h=new Date(e,t,1+(l-s)),v=p(this._d)?y(h,this._d):!1,b=y(h,r),w=l<s||l>=i+s,E=n.minDate&&h<n.minDate||n.maxDate&&h>n.maxDate||n.disableWeekends&&d(h)||n.disableDayFn&&n.disableDayFn(h);u.push(x(1+(l-s),t,e,v,b,E,w)),++c===7&&(n.showWeekNumber&&u.unshift(T(l-s,t,e)),o.push(N(u,n.isRTL)),u=[],c=0)}return A
(n,o)},isVisible:function(){return this._v},show:function(){this._v||(c(this.el,"is-hidden"),this._v=!0,this.draw(),this._o.bound&&(s(r,"click",this._onClick),this.adjustPosition()),typeof this._o.onOpen=="function"&&this._o.onOpen.call(this))},hide:function(){var e=this._v;e!==!1&&(this._o.bound&&o(r,"click",this._onClick),this.el.style.cssText="",l(this.el,"is-hidden"),this._v=!1,e!==undefined&&typeof this._o.onClose=="function"&&this._o.onClose.call(this))},destroy:function(){this.hide(),o(this.el,"mousedown",this._onMouseDown,!0),o(this.el,"change",this._onChange),this._o.field&&(o(this._o.field,"change",this._onInputChange),this._o.bound&&(o(this._o.trigger,"click",this._onInputClick),o(this._o.trigger,"focus",this._onInputFocus),o(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},O}),e.Pikaday=this.Pikaday},"@VERSION@",{affinity:"client"});
YUI.add("mobile-photo-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.isOwner=e.isOwner,this.nsid=e.nsid,this},loadState:function(){var t=this,n={};return n.photoEngagement=this.appContext.getModel("photo-engagement-models",this.photoId),n.photo=this.appContext.getModel("photo-models",this.photoId),this.isOwner&&(n.personModel=this.appContext.getModel("person-models",this.nsid)),(new e.FlickrPromise(n)).then(function(e){t.set("photo-engagement",e.photoEngagement),t.set("photo",e.photo)},function(t){e.Flog.error("[sub-photo-right-stats-view] Error loadState: ",t)})},buildContainer:function(){var e=this.get("photo-engagement"),t=e.toJSON(),n,r=!1,i=25,s=25;return t.commentCount>100&&(s=45),t.faveCount>100&&(i=45),this.isOwner&&this.appContext.flipper.isFlipped("rebootify-stats")&&this.isPro&&this.dailyViewsModel.getValue("totals").views>0&&(r=!0),n=this.templates("mobile-photo-engagement")({engagement:e.toJSON(),isMobileStats:this.isMobileStats,commentSvgMargin:s,faveSvgMargin:i,showMoreStatsLink:r}),this.setContainerHTML(n),this},activate:function(){var t=this.get("photo-engagement"),n=this.get("container"),r=this;return this.registerEventHandler(n.delegate("click",this.onFaveClick.bind(this),".fave-count")),this.registerEventHandler(n.delegate("click",this.onShareClick.bind(this),".share-container")),this.registerEventHandler(n.delegate("click",this.onCommentClick.bind(this),".comment-count")),t&&this.registerEventHandler(t.on("valuesChanged",function(n){var i,s=typeof n.faveCount!="undefined"||typeof n.isFaved!="undefined"||typeof n.canFave!="undefined";if(!s){typeof n["commentCount"]!="undefined"&&r.buildContainer();return}r.processingFave=!0,r.buildContainer(),i=t.remoteUpdate(),i.then(function(){r.processingFave=!1},function(i){if(i.code!==3){i.code!==5&&e.Object.each(n,function(e,n){t.setValue(n,e.prevVal)});var s=e.Views.dialog.getInstance("dialog-alert",{content:r.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),attrs:{title:r.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:r.intlMessage({intlName:"common.OK"})},appContext:r.appContext,dialogClass:"scrappy-dialog"});s.show()}r.processingFave=!1}).then(null,function(e){r.processingFave=!1})},r.photoId)),this},onFaveClick:function(t,n){var r=this,i=this.get("photo-engagement"),s=this.appContext.getUA().os,o=this.appContext.getUA().isWebview,u="photos/"+this.nsid+"/"+this.photoId;t.preventDefault();if(this.processingFave)return;this.processingFave=!0,this.appContext.getViewer().signedIn?i.getValue("canFave")&&(i.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick")):(e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:s,isWebview:o,pageURL:u,beacon:{name:"mpp_fave_signedout",section:"mpp_fave"},viewName:r.name})}),this.processingFave=!1)},onShareClick:function(){var t=new e.Views.FluidDroparound({appContext:this.appContext,preferLeft:!0,anchorOffsetVertical:10,anchorOffsetHorizontal:225,showDropArrow:!0,observePageResize:!0,anchorElement:this.get("container").one(".share-container svg"),htmlMessage:this.templates("mobile-share-modal")({shortUrl:e.URLHelper.getShortURL(this.photoId)})});this.registerEventHandler(t.on("activated",function(){var e=t.get("container").one("input")._node;e&&(e.focus(),setTimeout(function(){e.setSelectionRange(0,999)},0))},this)),t.show()},onCommentClick:function(){var t=e.one(".new-comment-text"),n=50,r=this,i=this.appContext.getUA().os,s=this.appContext.getUA().isWebview,o="photos/"+this.nsid+"/"+this.photoId;this.get("container").ancestor(".show-upsell-banner")&&(n=120),this.appContext.getViewer().signedIn?t&&(e.config.win.scrollTo(t.getX(),t.getY()-n),t.focus()):e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:i,isWebview:s,pageURL:o,beacon:{name:"mpp_comment_signedout",section:"mpp_comment"},viewName:r.name})})}})},"@VERSION@",{requires:["flickr-view","flickrui-css","hermes-template-mobile-photo-engagement","hermes-template-mobile-share-modal","photo-sidebar-actions-css","fluid-modal-view","fluid-droparound-view","stats-photo-view","stats-helper","url-helper"],optional:["photo-engagement-models"],langBundles:["common","photo-page-scrappy","fave-view","settings","info-charm","share-modal"]});
YUI.add("hermes-lang-settings",function(e,t){e.Intl.add("hermes/settings","en-US",{SAFE:["Safe"],MODERATE:["Moderate"],RESTRICTED:["Restricted"],PUBLIC:["Public"],PRIVATE:["Private"],FRIENDS:["Friends"],FAMILY:["Family"],FRIENDS_AND_FAMILY:["Friends & Family"],ONLY_YOU:["Only you"],PEOPLE_YOU_FOLLOW:["People you follow"],ANY_FLICKR_MEMBER:["Any Flickr member"],SOME_RIGHTS_RESERVED:["Some rights reserved"],ALL_RIGHTS_RESERVED:["All rights reserved"],ATTRIBUTION:["Attribution"],ATTRIBUTION_SHAREALIKE:["Attribution-ShareAlike"],ATTRIBUTION_NODERIVS:["Attribution-NoDerivs"],ATTRIBUTION_NONCOMMERCIAL:["Attribution-NonCommercial"],ATTRIBUTION_NONCOMMERCIAL_SHAREALIKE:["Attribution-NonCommercial-ShareAlike"],ATTRIBUTION_NONCOMMERCIAL_NODERIVS:["Attribution-NonCommercial-NoDerivs"],NO_COPYRIGHT_RESTRICTIONS:["No known copyright restrictions"],US_GOV_WORK:["United States government work"],PUBLIC_DOMAIN_DEDICATION:["Public Domain Dedication (CC0)"],PUBLIC_DOMAIN_WORK:["Public Domain Work"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-info-charm",function(e,t){e.Intl.add("hermes/info-charm","en-US",{CHANGE_PRIVACY_ERROR:["There was a problem changing your photo's privacy"],CHANGE_LICENSE_ERROR:["There was a problem changing your photo's license"],CHANGE_SAFETLY_ERROR:["There was a problem changing your photo's safety level"],PUBLIC_PHOTO:["This photo is public"],FRIENDS_AND_FAMILY_PHOTO:["This photo is visible by friends and family"],FRIENDS_PHOTO:["This photo is visible by friends"],FAMILY_PHOTO:["This photo is visible by family"],PRIVATE_PHOTO:["This photo is private"],PUBLIC:["Public"],"FRIENDS AND FAMILY":["Friends & Family"],FAMILY:["Family"],FRIENDS:["Friends"],PRIVATE:["Private"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-mobile-app-upsell",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){return"is-android"}function c(e,t){return"http://play.google.com/store/apps/details?id=com.yahoo.mobile.client.android.flickr"}function h(e,t){return"http://appstore.com/flickr"}function p(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"mobile.APP_ANDROID"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n				",r}function d(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"mobile.APP_IOS"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n				",r}function v(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"mobile.APP_ANDROID_FREE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n				",r}function m(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"mobile.APP_IOS_FREE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n				",r}function g(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"mobile.INSTALL"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n				",r}function y(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"mobile.GET"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n				",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div id="smartbanner" class="ios">\n	<!-- <button class="sb-close close-banner"></button> -->\n	<div class="sb-container">\n		<span class="sb-icon">\n			<svg class="close-banner icon icon-close"><use xlink:href="#icon-close"></use></svg>\n		</span>\n		<span class="sb-flickr-icon">\n			<div class="outer-logo ',o=n["if"].call(t,t.isAndroid,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='">\n				<div class="ball blue-ball"></div>\n				<div class="ball pink-ball"></div>\n			</div>\n		</span>\n		<div class="sb-info">\n			<a class="sb-button" href="',o=n["if"].call(t,t.isAndroid,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t.isIOS,{hash:{},inverse:f.noop,fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;s+='">\n				<strong>\n				',o=n["if"].call(t,t.isAndroid,{hash:{},inverse:f.noop,fn:f.program(7,p,i),data:i});if(o||o===0)s+=o;s+="\n				",o=n["if"].call(t,t.isIOS,{hash:{},inverse:f.noop,fn:f.program(9,d,i),data:i});if(o||o===0)s+=o;s+="\n				</strong>\n				<span>\n				",o=n["if"].call(t,t.isAndroid,{hash:{},inverse:f.program(13,m,i),fn:f.program(11,v,i),data:i});if(o||o===0)s+=o;s+='\n				</span>\n			</a>\n		</div>\n		<div class="sb-view get-app">\n			<span>\n				',o=n["if"].call(t,t.isAndroid,{hash:{},inverse:f.noop,fn:f.program(15,g,i),data:i});if(o||o===0)s+=o;s+="\n				",o=n["if"].call(t,t.isIOS,{hash:{},inverse:f.noop,fn:f.program(17,y,i),data:i});if(o||o===0)s+=o;return s+="\n			</span>\n		</div>\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-app-upsell",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("mobile-app-upsell-view",function(e){e.namespace("Views")[this.name]=e.Base.create("mobile-app-upsell-view",e.FlickrView,[],{langBundles:["common","mobile"],initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.buildContainer(),this},buildContainer:function(){var e=this.appContext.getUA().os;return this.setContainerHTML(this.templates("mobile-app-upsell")({isAndroid:e==="android",isIOS:e==="ios"})),this},activate:function(){var e=this.get("container"),t=e.one(".close-banner"),n=e.one(".get-app"),r=this;return t&&this.registerEventHandler(r.addBannerEvent(t,"dism",r.dismissBanner.bind(r))),n&&this.registerEventHandler(r.addBannerEvent(n,"inst",r.installApp.bind(r))),this},addBannerEvent:function(e,t,n){var r=this;return e.on("click",function(e){e.preventDefault(),r.appContext.setCookie({cookieName:t,path:"/",cookieValue:!0,remove:!0}),r.fire("subviewViewEvent","dismissBanner"),n()})},dismissBanner:function(){if(navigator.cookieEnabled){e.rapidTracker.beacon(this.name,"cookies_off",{section:"app-interstitial"});return}var t=parseInt(this.appContext.getCookie("flaidisn"),10);!t||isNaN(t)?t=0:t+=1,e.rapidTracker.beacon(this.name,"app_promo_interstitial_dismissed"+(t>0?"_"+(t+1):""),{section:"app-interstitial"});var n;t<2?n=e.moment().add(3,"days").toDate():t===2?n=e.moment().add(7,"days").toDate():t===3&&(n=e.moment().add(20,"year").toDate()),this.appContext.setCookie({cookieName:"flaidisn",cookieValue:1,expires:n,remove:!0,path:"/"})},installApp:function(){var t=this.appContext.getUA().os,n=this.appContext.getUA().isWebview,r="photos/"+this.nsid+"/"+this.photoId,i=this;e.rapidTracker.beacon(this.name,"app_promo_interstitial_download",{section:"app-interstitial"}),this.appContext.setCookie({cookieName:"flaidis",cookieValue:1,expires:e.moment().add(20,"year").toDate(),remove:!0,path:"/"}),setTimeout(function(){e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:t,isWebview:n,pageURL:r,beacon:{name:"app_promo_banner_open",section:"appbanner"},viewName:i.name})})},250)}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-app-upsell","mobile-app-upsell-css"],langBundles:["common","mobile"]});
YUI.add("hermes-lang-mobile",function(e,t){e.Intl.add("hermes/mobile","en-US",{APP_IOS:["Flickr for iOS"],APP_ANDROID:["Flickr for Android"],APP_IOS_FREE:["Free in the App Store"],APP_ANDROID_FREE:["Free in the Google Play"],GET:["Get"],INSTALL:["Install"]})},"@VERSION@",{requires:["intl"]});
YUI.add("mobile-photo-page-view",function(e){var t="show-upsell-banner";e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,additionalViewClasses:function(){var n=[],r=this.appContext.getUA().os,i=r==="ios"||r==="android";return i&&n.push(r),i&&!this.appContext.getCookie("dism")&&!this.appContext.getCookie("inst")&&(n.push(t),YUI.Env.isServer||e.rapidTracker.beacon(this.name,"app_promo_interstitial_shown",{section:"app-interstitial"})),n},initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.deferredViews={"sub-photo-comments-view":{photoId:this.photoId,nsid:this.nsid,isOnMobile:!0},"photo-charm-exif-scrappy-view":{photoId:this.photoId,nsid:this.nsid,isMobileExif:!0,additionalViewClasses:["light-background-view"]},"mobile-sub-photo-license-privacy-view":{photoId:this.photoId,nsid:this.nsid,additionalViewClasses:["light-background-view"]},"sub-photo-tags-tag-view":{photoId:this.photoId,nsid:this.nsid,isMobileTags:!0,additionalViewClasses:["light-background-view"]},"footer-full-view":{hideMobileBanner:!0}},this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"mobile-app-upsell-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"mobile-attribution-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["clear-float","mobile-photopage-attribution"]},"sub-photo-title-desc-view":{requiredToShowOnClient:!0,isMobile:!0,requiredToShowOnServer:!0},"mobile-photo-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"mobile-sub-photo-stats-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"mobile-photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e={"global-nav-view":this.subviews["global-nav-view"].get("container"),"mobile-photo-well-view":this.subviews["mobile-photo-well-view"].get("container"),"mobile-attribution-view":this.subviews["mobile-attribution-view"].get("container"),"sub-photo-title-desc-view":this.subviews["sub-photo-title-desc-view"].get("container"),"mobile-photo-engagement-view":this.subviews["mobile-photo-engagement-view"].get("container"),"mobile-sub-photo-stats-view":this.subviews["mobile-sub-photo-stats-view"].get("container"),"mobile-app-upsell-view":this.subviews["mobile-app-upsell-view"].get("container")};return this.setContainerHTML(this.templates("mobile-photo-page")(e)),this},buildHeadContainer:function(){var e=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"});this.set("headContainer",e),YUI.Env.isServer||this.updateHead()},isMobile:function(){var t=!1;return YUI.Env.isServer?t=this.appContext.request.UA.isMobileBrowser:t=e.config.flickr.request.UA.isMobileBrowser,t},activate:function(){var t=e.config.win.document.body;return t.scrollTop>0||t.clientHeight+100>=t.scrollHeight?this.loadDeferred():(this.scrollListener=e.globalEvents.subscribe("window:scroll",this.loadDeferred.bind(this)),this.registerEventHandler(this.scrollListener)),e.FastClick&&e.FastClick.attach(document.body),this},loadDeferred:function(){if(!this.loadingDeferred){this.loadingDeferred=!0;var e=Object.keys(this.deferredViews).length;this.removeScrollListener(),e>0&&this.recursivelyloadDeferredView(0)}},removeScrollListener:function(){this.scrollListener&&(this.scrollListener.detach(),this.scrollListener=null)},recursivelyloadDeferredView:function(t,n){var r=Object.keys(this.deferredViews).length,i=this;if(t<=r-1){var s=Object.keys(this.deferredViews)[t],o=this.deferredViews[s];this.getDeferredView(s,o).then(function(r){if(!r){e.Flog.error(i.name,"An error occured trying to load the deferred view."),n?(t++,n=!1):n=!0,i.recursivelyloadDeferredView(t,n);return}r.initialize().then(function(){r.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&i.onSubviewEvent.call(i,r.name,e.details)}),o&&o.additionalViewClasses&&o.additionalViewClasses.forEach(function(e){r.get("container").addClass(e)}),i.addDeferredViewToDOM(r),r.normalizedActivate(),t++,i.recursivelyloadDeferredView(t)}).catch(function(r){e.Flog.error(i.name,"An error occured trying to initialize the deferred view:",r),n?(t++,n=!1):n=!0,i.recursivelyloadDeferredView(t,n)})})}},getDeferredView:function(e,t){return this.appContext.getView(e,t)},addDeferredViewToDOM:function(e){var t=this.get("container").one(".deferred-views");t&&t.append(e.get("container"))},onSubviewEvent:function(e,n){n&&(n[0]==="dismissBanner"?this.get("container").removeClass(t):n[0]==="noTags"&&this.get("container").addClass("no-tags"))},getTrackingSegments:function(){return{vwrOwner:this.isOwner?1:0}}},{ATTRS:{spaceid:{value:954010555}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-image"})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-head-meta","hermes-template-mobile-photo-page","attribution-view","footer-full-view","mobile-photo-well-view","mobile-photo-engagement-view","flickr-view","flog","global-nav-view","mobile-app-upsell-view","url","browser-support","mobile-photo-page-css","mobile-photo-page-deferred-views","ttfp-recorder-plugin"],langBundles:[],optionalRequires:["fastclick"]});
YUI.add("fastclick",function(e,t){(function(){"use strict";function e(t,r){function s(e,t){return function(){return e.apply(t,arguments)}}var i;r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700;if(e.notNeeded(t))return;var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],u=this;for(var a=0,f=o.length;a<f;a++)u[o[a]]=s(u[o[a]],u);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,r){var i=Node.prototype.removeEventListener;e==="click"?i.call(t,e,n.hijacked||n,r):i.call(t,e,n,r)},t.addEventListener=function(e,n,r){var i=Node.prototype.addEventListener;e==="click"?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(t,e,n,r)}),typeof t.onclick=="function"&&(i=t.onclick,t.addEventListener("click",function(e){i(e)},!1),t.onclick=null)}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,r=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=r&&/OS 4_\d(_\d)?/.test(navigator.userAgent),s=r&&/OS [6-7]_\d/.test(navigator.userAgent),o=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(r&&e.type==="file"||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},e.prototype.focus=function(e){var t;r&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"&&e.type!=="month"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,s;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(r){s=window.getSelection();if(s.rangeCount&&!s.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},e.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,o,u,a,f,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,o=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,s&&(f=e.changedTouches[0],l=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),u=l.tagName.toLowerCase();if(u==="label"){t=this.findControl(l);if(t){this.focus(l);if(n)return!1;l=t}}else if(this.needsFocus(l)){if(e.timeStamp-o>100||r&&window.top!==window&&u==="input")return this.targetElement=null,!1;this.focus(l),this.sendClick(l,e);if(!r||u!=="select")this.targetElement=null,e.preventDefault();return!1}if(r&&!i){a=l.fastClickScrollParent;if(a&&a.fastClickLastScrollTop!==a.scrollTop)return!0}return this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?
(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,r,i,s;if(typeof window.ontouchstart=="undefined")return!0;r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(r){if(!n)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(o){i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(i[1]>=10&&i[2]>=3){t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}}}if(e.style.msTouchAction==="none"||e.style.touchAction==="manipulation")return!0;s=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(s>=27){t=document.querySelector("meta[name=viewport]");if(t&&(t.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth))return!0}return e.style.touchAction==="none"||e.style.touchAction==="manipulation"?!0:!1},e.attach=function(t,n){return new e(t,n)},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return e}):typeof module!="undefined"&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e})(),
/*!
 Copyright (c) 2014 The Financial Times Ltd.

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

*/
e.FastClick=window.FastClick},"@VERSION@",{affinity:"client"});
YUI.add("photo-well-scrappy-view",function(e){var t=1,n=5;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.entryURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.isAd=!!t.ad,this.hideBackToLink=t.hideBackToLink||!1,this.publisherUrl=t.publisherUrl,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.numberOfPositionsToPreFetch=t.numberOfPositionsToPreFetch,this.numberOfPositionsToRefetchAt=t.numberOfPositionsToRefetchAt,this},additionalViewClasses:["centered-content"],subviewConfig:{"photo-well-media-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-notes-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-notes")}},"photo-engagement-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"context-slider-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-sidebar-toggle-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,neverShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen"],disabled:function(){return this.appContext.experiments.fullscreen.disableRealFullscreenButtons()}},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:!0}},buildContainer:function(){var e=this,t,n="",r,i=0,s,o,u=".navigate-prev",a=".navigate-next",f,l,c,h,p,d;return this.subviews["photo-sidebar-actions-view"]&&this.subviews["photo-sidebar-actions-view"].get("container").addClass("is-hidden"),this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),n=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),n=this.subviews["attribution-view"].get("container")),this.get("contextModel")&&(r=this.get("contextModel").getValue("photoContextList").getList(),r.length>2&&r.some(function(t){return i++,t.getValue("id")===e.photoId})&&(s=r.slice(i-2,i-1),o=r.slice(i,i+1),s&&s.length>0&&(f=e.setupNavLink(s[0],u,"previous"),s[0].getValue("owner")&&(s[0].getValue("title").trim()===""?c=e.intlMessage({intlName:"common.UNTITLED"}):c=s[0].getValue("title"),c+=" | "+e.intlMessage({intlName:"common.BY_USER",user:s[0].getValue("owner").getValue("username")}))),o&&o.length>0&&(l=e.setupNavLink(o[0],a,"next"),o[0].getValue("owner")&&(o[0].getValue("title").trim()===""?h=e.intlMessage({intlName:"common.UNTITLED"}):h=o[0].getValue("title"),h+=" | "+e.intlMessage({intlName:"common.BY_USER",user:o[0].getValue("owner").getValue("username")}))))),p=this.getPhotoWellHeight(),d=p-70,t=this.templates("photo-well-scrappy")({"photo-well-media-view":this.subviews["photo-well-media-scrappy-view"].get("container"),"photo-notes-scrappy-view":this.subviews["photo-notes-scrappy-view"]?this.subviews["photo-notes-scrappy-view"].get("container"):"","context-slider-view":this.subviews["context-slider-scrappy-view"].get("container"),"is-hidden":!f&&!l,"prev-is-not-clickable":!f,"next-is-not-clickable":!l,"prev-url":f,"next-url":l,"prev-title":c,"next-title":h,"is-ad":this.isAd,"photo-sidebar-toggle-view":this.subviews["photo-sidebar-toggle-view"]?this.subviews["photo-sidebar-toggle-view"].get("container"):"","photo-sidebar-actions-view":this.subviews["photo-sidebar-actions-view"]?this.subviews["photo-sidebar-actions-view"].get("container"):"","attribution-view":n,"people-notes-view":this.subviews["people-notes-view"]?this.subviews["people-notes-view"].get("container"):"",height:p,"photo-engagement-view":this.subviews["photo-engagement-view"].get("container"),navHeight:d,entryURL:this.entryURL,backToLabel:this.intlMessage({intlName:"photo-page-scrappy."+this.entryTypeIntlKey}),enableZoom:this.appContext.flipper.isFlipped("enable-scrappy-zoom"),hideBackToLink:this.hideBackToLink}),this.setContainerHTML(t),YUI.Env.isServer||(this.subviews["photo-well-media-scrappy-view"]&&this.subviews["photo-well-media-scrappy-view"].fire("parentViewEvent","photoWellResized"),this.subviews["photo-notes-scrappy-view"]&&this.subviews["photo-notes-scrappy-view"].fire("parentViewEvent","photoWellResized")),YUI.Env.isServer&&(this.serverWidth=this.subviews["photo-well-media-scrappy-view"].serverWidth,this.serverHeight=this.subviews["photo-well-media-scrappy-view"].serverHeight),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){if(!e)throw new Error("[photo-well-view] Invalid photoModel returned from getModel");t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&n.push(this.appContext.getModelRegistry(this.contextData.modelName).then(function(n){var r;if(n){r=n.attributeSearch(t.contextData.params);if(r&&r.length&&n.exists(r[0]))return t.appContext.getModel(t.contextData.modelName,r[0]).then(function(e){e&&t.set("contextModel",e)},function(n){return e.Flog.error(t.name,"photo not found in context. Loading photostream instead."),t.loadPhotostreamContext()})}}).then(null,function(){return"whatever"})),e.Promise.all(n)},buildHeadContainer:function(){var e=this.templates("photo-page-right-size-express")({photoWidth:this.get("photo").getLargestSize().width,photoHeight:this.get("photo").getLargestSize().height});return this.set("headContainer",e),this},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.
hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=1500,o=250,u=!1,a=!1,f,l=!0,c=this;s=(s-500)/2,u=!0,a=this.appContext.experiments.fullscreen.getMode(),this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){f=n.one(".photo-sidebar-actions-view"),t&&l&&t.removeClass("is-hidden"),u&&l&&(f&&f.removeClass("is-hidden"),r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden")),clearTimeout(c.movingTimeout),clearTimeout(c.initialTimeout),l=!0,c.movingTimeout=setTimeout(function(){f=n.one(".photo-sidebar-actions-view"),u&&(f&&f.addClass("is-hidden"),i&&i.addClass("is-hidden"))},s*2)},o))),this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&(l=!1),c.initialTimeout=setTimeout(function(){l=!0,f=n.one(".photo-sidebar-actions-view"),u&&l&&(f&&f.addClass("is-hidden"),i&&i.addClass("is-hidden"))},s*2)},activate:function(){var r=this,i=this.contextData,s=0,o,u,a,f,l,c=".navigate-prev",h=".navigate-next",p=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return YUI.Env.isServer||(u=e.getLocation(),a=u.protocol,f=u.hostname,r.appContext.getModel(i.modelName,i.params).then(function(e){r.set("contextModel",e)},function(t){if(!t.getModelFailure&&t.code!==1||i.modelName==="photostream-models")throw e.one(c).hide(),e.one(h).hide(),t;return r.contextData.modelName="photostream-models",r.contextData.params.id=r.get("photo").getValue("owner").getValue("nsid"),r.appContext.getModel("photostream-models",r.contextData.params).then(function(e){r.set("contextModel",e)})}).then(function(){var t=r.get("contextModel").getValue("photoContextList"),n=t.getList(),o,u,p,d;return n.length>2&&n.some(function(e){return s++,e.getValue("id")===r.photoId})&&(o=n.slice(s-2,s-1),u=n.slice(s,s+1),o&&o.length>0&&(p=r.setupNavLink(o[0],c,"previous"),p&&(r.updateNavLinks(r.get("container").one(c),a,f,p),r.get("container").one(c).removeClass("no-click"))),u&&u.length>0&&(d=r.setupNavLink(u[0],h,"next"),d&&(r.updateNavLinks(r.get("container").one(h),a,f,d),r.get("container").one(h).removeClass("no-click")))),l=e.merge(i.params,{photoId:r.photoId,numNext:r.numberOfPositionsToPreFetch,numPrev:r.numberOfPositionsToPreFetch,refetchAt:r.numberOfPositionsToRefetchAt}),t.getContext(l)}).then(function(i){function s(s,o){var u=r.get("container").one(s),l,c,h,p,d,v,m=i&&i[o]&&i[o].length,g;if(!u)return;if(!m){u.remove();return}u.removeClass("no-click"),l=r.setupNavLink(i[o][0],s,o);if(r.isAd)h=r.appContext.adManager.origin,o===h.arrow?(u.setAttribute("href",h.url),u.removeClass("is-hidden")):(u.setAttribute("href",l),u.removeClass("is-hidden"));else{r.updateNavLinks(u,a,f,l),c=r.subviews["photo-well-media-scrappy-view"].getCanvasSize();for(v=0;v<n;v++){if(!i[o][v])break;p=i[o][v].getSizeToFit(c,{includeSizes:["sq","q","t","s","n"]}),p&&p.url&&(d=new Image,d.src=p.url)}for(v=0;v<t;v++){if(!i[o][v])break;p=i[o][v].getSizeToFit(c),p&&p.url&&(d=new Image,g=e.guid(),window.LH&&window.LH.mark("mark_time_to_load_photo_only_start"+g),d.onload=function(){if(d.onloadFired)return;d.onloadFired=!0;try{window.LH.mark("mark_time_to_load_photo_only"+g),window.LH.measure("time_to_load_photo_only",{startMark:"mark_time_to_load_photo_only_start"+g,endMark:"mark_time_to_load_photo_only"+g})}catch(t){e.Flog.warn("time to load photo: Missing start mark")}},d.src=p.url,d.complete&&(d.onloadFired=!0))}}}r.appContext.adManager.updateContext({prev:i.previous[0],current:r.get("photo"),next:i.next[0],type:r.contextData.modelName,entryURL:r.entryURL}),s(h,"next"),s(c,"previous"),r.animateNavigation(),r.isAd&&r.appContext.adManager.markAdAsSeen()},function(e){if(e.notInContext||e.code===99)return r.get("contextModel").setValue("photoContextList",[]),r.contextData.modelName="photostream-models",r.contextData.params.id=r.get("photo").getValue("owner").getValue("nsid"),r.activate();throw e}).then(null,function(e){r.appContext.warn("There was a problem initializing the next/previous controls.",e&&e.message?e.message:e,e&&e.stack?e.stack:"")}),p&&this.attachKeyEvent("down:37,75,39,74",r.handlePrevNextKeys.bind(r)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"),this.publisherUrl||this.appContext.getReferrer())),o={":ad":r.setLinkAsAdFriendly},p&&!this.hideBackToLink&&this.attachKeyEvent("down:66",function(t){t.preventDefault(),e.rapidTracker.beacon(r.name,"backToContextKeyPress"),r.appContext.flapp.hasRoute(r.entryURL)?r.appContext.flapp.navigate(r.entryURL):e.config.win.location.href=r.entryURL}),r.registerEventHandler(e.on("resize",e.betterThrottle(function(e){r.set("canvasSizeIsDirty",!0),r.buildContainer()},16))),r.buildContainer(),r.attachEvents(o),this},getPhotoWellHeight:function(){var e=500,t=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight()-50,r=1,i=2.3,s=2.75,o=120,u=t/r+o,a=t/i+o,f=t/s,l;return n>u?l=t/r:n>a?l=n-o:n>f?l=n-o+o*(n-a)/(f-a):l=n,Math.max(e,Math.round(l))},setupNavLink:function(t,n,r){var i=this.get("container").one(n),s,o;if(!t){i.remove();return}s=t,o=e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix")});if(!o||o==="#"){this.appContext.warn("[photo-well-view] Invalid next/prev URL:",o),i.remove();return}return o},updateNavLinks:function(e,t,n,r){e.setAttribute("href",t+"//"+n+r),e.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},handlePrevNextKeys:function(t){var n=this,r,i,s,o=50;if(t.button===37||t.button===75)i=".navigate-prev",s="previous",e.rapidTracker.beacon
(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)i=".navigate-next",s="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");i&&n.get("container").one(i)&&(t.preventDefault(),r=n.get("container").one(i).getAttribute("href"),r&&r!=="#"&&(n.keyboardNavigation&&n.keyboardNavigation.url&&r===n.keyboardNavigation.url&&(new Date).getTime()-n.keyboardNavigation.time<o?n.appContext.debug("[photo-well-view] Ignoring duplicate keyboard navigation within "+o+"ms",r):(n.keyboardNavigation={url:r,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,s,r),n.appContext.flapp.navigate(r))))},handleContextMenu:function(e){e.preventDefault(),this.fire("parentViewEvent","rightClickPhoto")}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well-scrappy","photo-well-scrappy-css","url-helper","better-throttle","hermes-template-photo-page-right-size-express"],optional:["photo-well-media-scrappy-view","context-slider-scrappy-view","photo-engagement-view","photo-models","photo-route"],langBundles:["common","photo-page-scrappy"]});
