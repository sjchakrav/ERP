YUI.add("photostream-models",function(e,t){function n(e){n.superclass.constructor.call(this,e)}e.Models[this.name]=n,e.extend(n,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.appContext.getViewer(),n=this.getValue(e,"normalizedId"),r;return t&&t.nsid===n?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(r=this.getValue(e,"owner"),r?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:r.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"}))}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=this.getValue(e,"normalizedId"),r=t?t.getValue("pathAlias"):n;return"/photos/"+r+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,r=n.splitCompoundId(e);return r.orderBy?(t=r.orderBy,r.viewAs?t+="-"+r.viewAs:r.orderBy==="dateposted"&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,n){var r=e;return t&&(r+="-"+t),n&&(t||(r+="-dateposted"),r+="-"+n),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]});
YUI.add("flickr-people-getInfo-fetcher",function(e,t){"use strict";function n(t,n){var r={datecreate:1};r.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&t.id===n.request.probableUser&&(r.storage=1,r.extras+=", classic_user_id, active_group_membership, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout",n.flipper.isFlipped("enable-new-pro")&&(r.extras+=", products_features")),t.extras&&typeof t.extras=="string"&&t.extras.length>0&&(r.extras=r.extras+","+t.extras);if(t.id)r.user_id=t.id;else{if(!t.pathAlias)throw new Error("`fetch` is missing required params.");r.path_alias=t.pathAlias}return t.storage&&(r.storage=t.storage),r.extras||(r.extras=""),r.extras+=", has_stats",r}function r(t,n,r){var i=t.apiResponse,s=t.personModelRegistry,o=t.personRelationshipModelRegistry,u=t.personProfileModelRegistry,a=t.personPreferencesModelRegistry,f=t.personGroupsModelRegistry,l=t.personNotificationsModelRegistry,c=t.personCurationModelRegistry,h=t.photostreamModelRegistry,p,d=i.person,v,m=r.getViewer(),g=d.id;return s.exists(g)||s.add({id:g,pathAlias:d.pathAlias,username:d.username&&d.username._content,realname:d.realname&&d.realname._content,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(d.iconurls),isAdFree:d.isAdFree,isPro:d.ispro,canBuyPro:d.canBuyPro,hasStats:d.hasStats,location:d.location&&d.location._content,hasAdfree:d.hasAdfree,has1TB:d.has1TB,has2TB:d.has2TB,hasFreeStandardShipping:d.hasFreeStandardShipping,hasFreeEducationalResources:d.hasFreeEducationalResources,dateCreated:d.datecreate._content}),l.exists(g)?l.setValue(g,"unreadNotificationCount",3):l.add({id:g,unreadNotificationCount:0,unreadFlickrMailCount:0}),o.exists(g)||o.add({id:g,pathAlias:d.pathAlias,isContact:d.contact,isFriend:d.friend,isFamily:d.family,isIgnored:d.ignored,isIgnoredBy:d.ignoredby}),m&&m.signedIn&&g===m.nsid&&(v={id:g},d.safeSearch&&(v.safeSearch=(d.safeSearch||1)-1),d.viewPrefs&&(v.unifiedSearchViewPref=d.viewPrefs.unifiedSearchViewPref,v.photostreamViewOrderPref=d.viewPrefs.photostreamViewOrderPref,v.photostreamViewAsPref=d.viewPrefs.photostreamViewAsPref,v.albumViewLayoutPref=d.viewPrefs.albumViewLayout),a.exists(g)?a.setValues(g,v):a.add(v)),u.exists(g)||(p={id:g,coverPhotoUrls:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(d.coverphoto_url),photoCount:d.photos.count.content,location:d.location?d.location.content:null},d.storage&&(p.storageUsed=d.storage.used.content,p.storageTotal=d.storage.total.content),d.unreadMessages&&(p.unreadMessages=d.unreadMessages.content),u.add(p)),f.exists(g)||f.add({id:g,memberCount:d.groupMemberships?d.groupMemberships.member:null,moderatorCount:d.groupMemberships?d.groupMemberships.moderator:null,adminCount:d.groupMemberships?d.groupMemberships.admin:null,invitedCount:d.groupMemberships?d.groupMemberships.invited:null}),c.exists(g)&&c.remove(g),c.add({id:g,enrollmentStatus:d.curation&&d.curation.status_name||"",canPassOver:d.curation&&d.curation.can_pass_over||!1}),h.exists(g)||h.add({id:g,pathAlias:d.pathAlias,owner:s.proxy(g),totalItems:d.photos.count&&d.photos.count.content}),d}function i(n,r){var i=this,s=r.getViewer();return s&&s.signedIn&&(n.id===s.nsid||n.nsid===s.nsid)&&(n.storage=1),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.people.getInfo",this._processParams(n,r)),personModelRegistry:r.getModelRegistry("person-models"),personRelationshipModelRegistry:r.getModelRegistry("person-relationship-models"),personProfileModelRegistry:r.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:r.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:r.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:r.getModelRegistry("person-notifications-models"),personCurationModelRegistry:r.getModelRegistry("person-curation-models"),photostreamModelRegistry:r.getModelRegistry("photostream-models")})).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","person-curation-models","photostream-models","api-helper"]});
YUI.add("person-model-helper",function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return e}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return"/photos/"+t+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});
YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},canBuyPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var n=this.getValue(t,"isPro"),r=this.getValue(t,"isAdFree");return n||r}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},curation:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper","person-curation-models"]});
YUI.add("flickr-photos-getHtmlMeta-fetcher",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;n&&n.HTMLMETA&&(i={id:n.photoId,title:n.HTMLMETA["og:title"],keywords:n.HTMLMETA.keywords,noindexfollow:n.HTMLMETA.noindexfollow,"og:title":n.HTMLMETA["og:title"],"og:description":n.HTMLMETA["og:description"],"og:type":n.HTMLMETA["og:type"],"og:url":n.HTMLMETA["og:url"],"og:image":n.HTMLMETA["og:image"],"og:image:width":n.HTMLMETA["og:image:width"],"og:image:height":n.HTMLMETA["og:image:height"],"flickr_photos:by":n.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":n.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":n.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":n.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":n.HTMLMETA["flickr_photos:galleries"],"twitter:card":n.HTMLMETA["twitter:card"],"twitter:description":n.HTMLMETA["twitter:description"],"twitter:app:url:iphone":n.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":n.HTMLMETA["twitter:creator"]},r.exists(t.id)||r.add(i))}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getHtmlMeta",s),r.getModelRegistry("photo-head-meta-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getHtmlMeta"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-head-meta-models"]});
YUI.add("photo-head-meta-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getHtmlMeta"].run(t,this.appContext)}},getFieldsForDisplay:function(e){var t={},n=["title","noindexfollow","keywords","og:title","og:description","og:type","og:url","og:image","og:image:width","og:image:height","flickr_photos:by","flickr_photos:camera","flickr_photos:sets","flickr_photos:groups","flickr_photos:galleries","twitter:card","twitter:description","twitter:app:url:iphone","twitter:creator","pinterest"],r=this;return n.forEach(function(n){var i=r.getValue(e,n);typeof i!="undefined"&&(t[n]=i)}),t},attributes:{"og:title":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},noindexfollow:{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},keywords:{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},title:{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"og:description":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"og:type":{},"og:url":{},"og:image":{},"og:image:width":{},"og:image:height":{},"flickr_photos:by":{},"flickr_photos:camera":{},"flickr_photos:sets":{},"flickr_photos:groups":{},"flickr_photos:galleries":{},"twitter:card":{},"twitter:description":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"twitter:app:url:iphone":{},"twitter:creator":{},pinterest:{setter:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getHtmlMeta-fetcher","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("photo-notes-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},attributes:{notes:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getInfo-fetcher"]});
YUI.add("flickr-photos-addNotes-creator",function(e,t){"use strict";function n(e){e.tags=e.tags||[];var t={};return t.photo_id=e.photoId,t.note_x=e.left,t.note_y=e.top,t.note_w=e.width,t.note_h=e.height,t.note_text=e.text,t}function r(e,t){var n=e[0],r=e[1],i=e[2],s=[];return i.exists(n.note.id)||i.add({id:n.note.id,left:t.noteLeft,top:t.noteTop,width:t.noteWidth,height:t.noteHeight,text:t.noteText}),s.push(i.proxy(n.note.id)),r.exists(t.photoId)?s.forEach(function(e){r.getValue(t.photoId,"notes").appendToList(e)}):r.add({id:t.photoId,notes:s}),s}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photos.notes.add",this._processParams(n)),r.getModelRegistry("photo-notes-models"),r.getModelRegistry("note-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-photos-addNotes"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-notes-models","note-models"]});
YUI.add("flickr-photos-editNote-updater",function(e,t){"use strict";function n(e){var t={};return t.note_id=e.noteId,t.note_x=e.noteX,t.note_y=e.noteY,t.note_w=e.noteW,t.note_h=e.noteH,t.note_text=e.noteText,t}function r(n,r){return r.callAPI("flickr.photos.notes.edit",this._processParams(n)).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-editNote"]={run:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-deleteNote-deletor",function(e,t){"use strict";function n(n,r){var i={};return i.note_id=n,r.callAPI("flickr.photos.notes.delete",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-deleteNote"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("note-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-addNotes"].run(t,this.appContext)},update:function(t,n){var r;return r={noteId:t,noteX:this.getValue(t,"left"),noteY:this.getValue(t,"top"),noteW:this.getValue(t,"width"),noteH:this.getValue(t,"height"),noteText:this.getValue(t,"text")},e.ModelUpdaters["flickr-photos-editNote"].run(r,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-deleteNote"].run(t,this.appContext)}},attributes:{authorName:{setter:function(e){return e}},author:{setter:function(e){return e}},left:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},top:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},width:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},height:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},text:{setter:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-addNotes-creator","flickr-photos-editNote-updater","flickr-photos-deleteNote-deletor","attribute-helpers"]});
YUI.add("flickr-photos-deleteAutotags-deletor",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.photos.deleteAutotags",n).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-deleteAutotags"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("autotag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{"delete":function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotagValue:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},score:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isPrivate:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},searchUrl:{derivedBy:["autotagValue"],readOnly:!0,defaultFn:function(e){var t=this.getValue(e,"autotagValue");return"/search/?q="+t}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});
YUI.add("photo-autotags-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{"delete":function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotags:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});
YUI.add("flickr-photos-setPerms-updater",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;i=r.attributeSearch({normalizedId:t.nsid},!0),i.forEach(function(e){r.remove(e)});if(t.full_response)return n.photoIdsSent=t.photo_ids,n}function r(n,r){var i=this;return n.nsid=r.getViewer().nsid,e.Promise.all([r.callAPI("flickr.photos.setPerms",n),r.getModelRegistry("photostream-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setMeta-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.full_response=1,i.photo_ids=n.photoId):i.photo_id=n.photoId,typeof n.title!="undefined"&&(i.title=n.title),typeof n.description!="undefined"&&(i.description=n.description),e.Promise.all([r.callAPI("flickr.photos.setMeta",i),r.getModelRegistry("photo-models")]).then(function(e){var t=e[0],i=e[1];if(n.fullResponse){if("errors"in t)return t.api="setMeta",t}else{if(!i.exists(n.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");!t.photo||!t.photo.title||!t.photo.description?r.warn("[flickr-photos-setMeta-updater] - No updated data returned from API."):i.setValues(n.photoId,{title:t.photo.title.content,description:t.photo.description.content})}},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setMeta"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:n}},"@VERSION@",{requires:["flickr-promise","flog"],optional:[]});
YUI.add("flickr-photos-licenses-setLicense-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.photo_ids=n.photoId,i.full_response=1):i.photo_id=n.photoId,i.license_id=n.license,r.callAPI("flickr.photos.licenses.setLicense",i).then(function(e){if("errors"in e)return e.api="setLicense",e},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setLicense"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setSafetyLevel-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.photo_ids=n.photoId,i.full_response=1):i.photo_id=n.photoId,i.safety_level=n.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",i).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setSafety"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[];return("title"in n||"description"in n)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title?n.title.newVal:this.getValue(t,"title"),description:n.description?n.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license.newVal},this.appContext)),"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:n.safetyLevel.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,n){var r=[];return"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(n.safetyLevel,10),fullResponse:1},this.appContext)),"title"in n&&"description"in n?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title,description:n.description,fullResponse:1},this.appContext)):"title"in n?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title,fullResponse:1},this.appContext)):"description"in n&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:n.description,fullResponse:1},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getGuestpass:function(t){var n=this;return new e.Promise(function(e,r){n.getValue(t,"guestpass")?e():n.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then(function(r){n.setValue(t,"guestpass",r.guestpass.url),e()})})},attributes:{title:e.PhotoModelHelper.attributes.title,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,curationIs3MP:e.PhotoModelHelper.attributes.curationIs3MP,curationOwnerCountryApproved:e.PhotoModelHelper.attributes.curationOwnerCountryApproved,curationOwnerFollowedByCurators:e.PhotoModelHelper.attributes.curationOwnerFollowedByCurators,curationOwnerAdded:e.PhotoModelHelper.attributes.curationOwnerAdded,curationOwnerPassedOver:e.PhotoModelHelper.attributes.curationOwnerPassedOver,curationBorderColor:e.PhotoModelHelper.attributes.curationBorderColor,owner:{isModel:!0},engagement:{isModel:!0},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},isHD:{},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},isMarketplacePrintable:{defaultFn:function(e){return!1}},oWidth:{},oHeight:{},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},hasInvalidColorspaceForPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(t){var n=this.getValue(t,"sizes");return e.Object.each(n,function(e,t){e.src=e.url}),n}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});
YUI.add("flickr-photos-getInfo-fetcher",function(e,t){"use strict";function n(t){var n,r;return n=["sizes","icon_urls","ignored","rev_ignored","venue","datecreate","is_marketplace_printable","o_dims"].join(","),n=n+","+e.APIHelper.request.getRebootPhotoExtras(),r={datecreate:1,extras:n,photo_id:t.id,get_contexts:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"},t.userId?r.user_id=t.userId:t.pathAlias&&(r.path_alias=t.pathAlias),t.context&&(r.context=t.context,r.num_prev=1,r.num_next=1),t.scrappy&&(e.APIHelper.request.addStaticMapsParams(r),delete r.get_contexts,delete r.primary_photo_extras,delete r.context),r}function r(t,n,r){var s=t.apiResponse,o=t.photoRegistry,u=t.personRegistry,a=t.personRelationshipRegistry,f=t.photoEngagementRegistry,l=t.photoStatsRegistry,c=t.photoPrivacyRegistry,h=t.photoNotesRegistry,p=t.noteRegistry,d=t.photoGeoRegistry,v=t.photoLocationRegistry,m=t.photoHeadMetaRegistry,g=t.groupRegistry,y,b={},w,E,S,x,T,N,C=[],k,L,A;w={id:s.photo.id,title:s.photo.title.content,description:s.photo.description.content,sizes:e.APIHelper.response.parsePhotoSize(s.photo.sizes.size,!0),needsInterstitial:s.photo.needsInterstitial,canComment:s.photo.editability.cancomment,canAddMeta:s.photo.editability.canaddmeta,safetyLevel:s.photo.safetyLevel,license:s.photo.license,mediaType:s.photo.media,secret:s.photo.secret,isHD:e.APIHelper.response.isHD(s.photo.sizes.size),rotation:s.photo.rotation,hasInvalidColorspaceForPrint:s.photo.hasInvalidColorspaceForPrint,isMarketplacePrintable:s.photo.isMarketplacePrintable,oWidth:s.photo.oWidth?parseInt(s.photo.oWidth,10):"",oHeight:s.photo.oHeight?parseInt(s.photo.oHeight,10):""},E={id:s.photo.owner.nsid,username:s.photo.owner.username,realname:s.photo.owner.realname,pathAlias:s.photo.owner.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.photo.owner.iconurls),isAdFree:s.photo.owner.isAdFree,isPro:s.photo.owner.ispro,dateCreated:s.photo.owner.datecreate,location:s.photo.owner.location},S={id:s.photo.owner.nsid,pathAlias:s.photo.owner.pathAlias,isContact:s.photo.contactIscontact,isFamily:s.photo.contactIsfamily,isFriend:s.photo.contactIsfriend,isIgnored:s.photo.owner.isignored,isIgnoredBy:s.photo.owner.revIgnored},x={id:s.photo.id,ownerNsid:s.photo.owner.nsid,isFaved:s.photo.isfavorite||!1,canShare:s.photo.usage.canshare,canDownload:s.photo.usage.candownload,commentCount:s.photo.comments.content,noteCount:s.photo.notes&&s.photo.notes.note&&s.photo.notes.note.length,faveCount:s.photo.countFaves,viewCount:s.photo.views},T={id:s.photo.id,dateTaken:s.photo.dates.taken,datePosted:s.photo.dates.posted,takenGranularity:s.photo.dates.takengranularity,isDateTakenUnknown:s.photo.datetakenunknown||s.photo.datetakenunknown==="1"||s.photo.datetakenunknown===1},k={id:s.photo.id,title:s.photo.HTMLMETA["og:title"],noindexfollow:s.photo.owner.noindexfollow,keywords:s.photo.HTMLMETA.keywords,"og:title":s.photo.HTMLMETA["og:title"],"og:description":s.photo.HTMLMETA["og:description"],"og:type":s.photo.HTMLMETA["og:type"],"og:url":s.photo.HTMLMETA["og:url"],"og:image":s.photo.HTMLMETA["og:image"],"og:image:width":s.photo.HTMLMETA["og:image:width"],"og:image:height":s.photo.HTMLMETA["og:image:height"],"flickr_photos:by":s.photo.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":s.photo.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":s.photo.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":s.photo.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":s.photo.HTMLMETA["flickr_photos:galleries"],"twitter:card":s.photo.HTMLMETA["twitter:card"],"twitter:description":s.photo.HTMLMETA["twitter:description"],"twitter:app:url:iphone":s.photo.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":s.photo.HTMLMETA["twitter:creator"],pinterest:s.photo.HTMLMETA.pinterest},N={id:s.photo.id,isPublic:s.photo.visibility.ispublic,isVisibleByFriends:s.photo.visibility.isfriend,isVisibleByFamily:s.photo.visibility.isfamily,permAddMeta:s.photo.permissions?s.photo.permissions.permaddmeta:0,permComment:s.photo.permissions?s.photo.permissions.permcomment:0},s.photo&&s.photo.notes&&s.photo.notes.note&&e.Array(s.photo.notes.note).forEach(function(e){p.exists(e.id)||p.add({id:e.id,authorName:e.authorname,author:e.author,left:e.x,top:e.y,width:e.w,height:e.h,text:e.content}),C.push(p.proxy(e.id))}),L=e.ModelFetchers["flickr-photos-getLocation"].mapResponse(s,d),w.owner=u.exists(E.id)?u.proxy(E.id):u.add(E),w.engagement=f.exists(x.id)?f.proxy(x.id):f.add(x),a.exists(S.id)||a.add(S),A=o.exists(w.id)?o.proxy(w.id):o.add(w),s.photo.isMarketplacePrintable&&A.setValue("isMarketplacePrintable",!0),l.exists(w.id)||l.add(T),c.exists(w.id)||c.add(N),h.exists(w.id)||h.add({id:w.id,notes:C}),m.exists(w.id)||m.add(k),v.exists(w.id)||v.add(L),s.photo.contexts&&(y=t.contextsRegistry,b.faves=t.favoriteRegistry,b.gallery=t.galleryRegistry,b.pool=t.groupsPoolRegistry,b.set=t.setRegistry,b.stream=t.photostreamRegistry,i({photoModel:A,contextRegistries:b,contextsResponse:s.photo.contexts,personRegistry:u,contextsRegistry:y,photoEngagementRegistry:f,photoStatsRegistry:l,groupRegistry:g,apiParams:r}))}function i(t){var n=t.photoModel,r=t.contextRegistries,i=t.contextsResponse,s=t.personRegistry,o=t.contextsRegistry,u=t.photoEngagementRegistry,a=t.photoStatsRegistry,f=t.groupRegistry,l=t.apiParams,c=[];e.Object.each(r,function(t,r){i[r]&&e.Array.each(i[r],function(r){e.APIHelper.response.addContextToRegistry(r,t,s,f),c.push(t.proxy(r.id)),l.context&&function(){var i,o,f,c,h,p,d,v,m;i=t.getValue(r.id,"photoContextList"),o=i.hasMinBoundary?i.hasMinBoundary():!1,f=i.hasMaxBoundary?i.hasMaxBoundary():!1,c=i.getList(),p=r.nextphotos,d=r.prevphotos,v=p?e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:s,photoModelRegistry:n.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}):[],m=d?e.APIHelper.response.parsePhotos({photos:d.photo,personModelRegistry:s,photoModelRegistry:n.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}):[];if(
m.length||v.length)h=e.APIHelper.response.addOrReplaceListByContext({model:n,next:v,prev:m.reverse(),current:c,hasMin:o,hasMax:f,numNext:l.num_next,numPrev:l.num_prev});t.setValue(r.id,"photoContextList",h)}()})}),o.exists(n.id)||(o.add({id:n.id,totalGroups:i.pool?i.pool.length:0,totalSets:i.set?i.set.length:0,totalGalleries:i.gallery?i.gallery.length:0}),o.setValue(n.id,"contexts",c))}function s(n,r){var i=this,s;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(n.scrappy=!0),s=this._processParams(n),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.photos.getInfo",s),photoRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),personRelationshipRegistry:r.getModelRegistry("person-relationship-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models"),photoPrivacyRegistry:r.getModelRegistry("photo-privacy-models"),photoNotesRegistry:r.getModelRegistry("photo-notes-models"),noteRegistry:r.getModelRegistry("note-models"),photoGeoRegistry:r.getModelRegistry("photo-geo-models"),photoLocationRegistry:r.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:r.getModelRegistry("photo-head-meta-models"),groupRegistry:r.getModelRegistry("group-models"),contextsRegistry:r.getModelRegistry("photo-contexts-models"),favoriteRegistry:r.getModelRegistry("favorite-models"),galleryRegistry:r.getModelRegistry("gallery-models"),groupsPoolRegistry:r.getModelRegistry("group-pool-models"),setRegistry:r.getModelRegistry("set-models"),photostreamRegistry:r.getModelRegistry("photostream-models")})).then(function(e){return i._processResponse(e,r.flipper,s)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:s,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-geo-models","photo-location-models","photo-head-meta-models","note-models","photo-notes-models","autotag-models","photo-autotags-models"]});
YUI.add("photo-geo-models",function(e){function r(e){r.superclass.constructor.call(this,e)}var t=1,n=16;e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext).then(function(e){return e},function(){})},update:function(t,n){var r={photo_id:t,lat:this.getValue(t,"latitude"),lon:this.getValue(t,"longitude"),accuracy:this.getValue(t,"accuracy")};return e.ModelUpdaters["flickr-photos-geo-setLocation"].run(r,this.appContext)}},attributes:{hasGeo:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},latitude:{validator:function(t,n){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||undefined},defaultValue:undefined},longitude:{validator:function(t,n){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||undefined},defaultValue:undefined},accuracy:{validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(r){return e.AttributeHelpers.coerceInteger(Math.max(t,Math.min(r,n)))||undefined},defaultValue:t}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getInfo-fetcher","attribute-helpers","flickr-photos-geo-setLocation-updater"]});
YUI.add("flickr-favorites-getContext-fetcher",function(e,t){"use strict";function n(t){var n={photo_id:t.photoId,num_prev:t.numNext,num_next:t.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()};return t.id?n.user_id=t.id:n.path_alias=t.pathAlias,n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=[],l=[],c=s.proxy(n.photoId),h,p,d,v,m,g,y=[];return h=r.prevphotos,p=r.nextphotos,l=e.APIHelper.response.parsePhotos({photos:h.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),f=e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),g=i.getValue(n.id,"photoContextList"),v=g.hasMinBoundary?g.hasMinBoundary():!1,m=g.hasMaxBoundary?g.hasMaxBoundary():!1,d=g.getList(),y=e.APIHelper.response.addOrReplaceListByContext({model:c,next:l,prev:f.reverse(),hasMax:m,hasMin:v,current:d,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",y),{next:l,previous:f.reverse()}}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.favorites.getContext",this._processParams(n),!0),r.getModelRegistry("favorite-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models")]).then(function(e){return i._processResponse(e,n)},function(e){throw e.code===3&&e.message==="Photo not a favorite"&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-favorites-getContext"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","type-validator"],optional:["favorite-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});
